---
name: doc-query
description: Targeted query capabilities for machine-readable codebase documentation generated by the `Skill(code-doc)` skill. It enables fast, structured lookups of classes, functions, modules, dependencies, and complexity metrics without parsing source code directly.
---

# doc-query: Codebase Documentation Query System

## Description

The `Skill(doc-query)` skill provides targeted query capabilities for machine-readable codebase documentation generated by the `Skill(code-doc)` skill. It enables fast, structured lookups of classes, functions, modules, dependencies, and complexity metrics without parsing source code directly.

## Key Features

- **Entity Lookup**: Find classes, functions, and modules by exact name or regex pattern
- **Module Summaries**: `describe-module` surfaces docstrings, hot spots, dependencies, and key entities in one call
- **JSON Everywhere**: Pass `--json` to any command for structured output ready for `jq`, scripts, or downstream tools
- **Complexity Analysis**: Identify refactoring candidates with configurable complexity thresholds
- **Dependency Mapping**: Understand module relationships and perform impact analysis
- **Context Gathering**: Smart context collection for specific tasks or feature areas

## When to Use This Skill

### ✅ Use `Skill(doc-query)` when:

1. **Starting a new task** - Quickly find relevant classes, functions, and modules
2. **Bug fixing** - Locate specific functions and understand their dependencies
3. **Feature implementation** - Find similar existing implementations to follow patterns
4. **Refactoring** - Identify high-complexity functions that need attention
5. **Impact analysis** - Understand what modules will be affected by changes
6. **Test planning** - Find test files and estimate coverage
7. **Code exploration** - Navigate and understand codebase structure with module-level summaries

### ❌ Don't use `Skill(doc-query)` when:

1. Documentation hasn't been generated yet (run `Skill(code-doc)` skill first)
2. You need to read actual source code (use `Explore` or `Read` tool instead)
3. You need to analyze runtime behavior (use debugging tools)
4. Documentation is stale (regenerate with `Skill(code-doc)` first)

## Tool Verification

**Before using this skill**, verify the required tools are available:

```bash
# Verify sdd doc CLI is installed and accessible
sdd doc --help
```

**Expected output**: Help text showing available commands (stats, search, find-class, describe-module, etc.)

**IMPORTANT - CLI Usage Only**:
- ✅ **DO**: Use `sdd doc` CLI wrapper commands (e.g., `sdd doc stats`, `sdd doc search`, `sdd doc find-class`)
- ❌ **DO NOT**: Execute Python scripts directly (e.g., `python doc_query.py`, `bash python cli.py`)

The CLI provides proper error handling, validation, argument parsing, and interface consistency. Direct script execution bypasses these safeguards and may fail.

If the verification command fails, ensure the SDD toolkit is properly installed and accessible in your environment.

## Requirements

- Documentation must be generated by `Skill(code-doc)` skill
- Documentation files expected in `docs/` directory:
  - `documentation.json` (required)
  - `AI_CONTEXT.md` (optional, for quick reference)
  - `ARCHITECTURE.md` (optional, for system design)
  - `DOCUMENTATION.md` (optional, for human-readable reference)

**Note**: You should NOT read the `documentation.json` or `DOCUMENTATION.md` documents manually.

## Auto-Detection

`sdd doc` CLI automatically searches for documentation in multiple locations (in order of priority):

1. **Current directory**: `./docs/`
2. **Parent directory**: `../docs/`
3. **Alternative naming**: `./documentation/`
4. **Claude home**: `~/.claude/docs/`

**No --docs-path needed** for most cases! The tool will find your documentation automatically.

**Explicit path override**: Use `--docs-path PATH` to specify a custom location:
```bash
sdd doc stats --docs-path /path/to/project/docs
```

**Check detection**: The `stats` command shows which path was detected:
```bash
sdd doc stats
# Output includes: "Found documentation at: /path/to/docs"
```

## Available Operations

### 1. Find Class

Find a specific class by exact name or regex pattern.

```bash
sdd doc find-class <name> [--pattern] [--docs-path PATH]
```

**Examples:**
```bash
# Find exact class
sdd doc find-class WizardSession

# Find classes matching pattern
sdd doc find-class ".*Session.*" --pattern
```

**When to use:**
- Starting work on a feature involving a specific class
- Understanding inheritance hierarchies
- Finding class implementation location

### 2. Find Function

Find a specific function by exact name or regex pattern.

```bash
sdd doc find-function <name> [--pattern] [--docs-path PATH]
```

**Examples:**
```bash
# Find exact function
sdd doc find-function calculate_score

# Find functions matching pattern
sdd doc find-function ".*score.*" --pattern
```

**When to use:**
- Bug fixing in a specific function
- Understanding function complexity and parameters
- Finding function implementation location

### 3. Describe Module

Produce a rich summary for a specific module, including docstring, key classes/functions, dependencies, and complexity signals.

```bash
sdd doc describe-module <module> [--top-functions N] [--include-docstrings] [--skip-dependencies] [--docs-path PATH]
```

**Examples:**
```bash
# Quick overview with defaults
sdd doc describe-module app/services/scoring.py

# Focus on the top 3 complex functions and include docstring snippets
sdd doc describe-module app/services/scoring.py --top-functions 3 --include-docstrings

# Export summary as JSON for downstream tooling
sdd doc describe-module scoring.py --json
```

**When to use:**
- Evaluating an unfamiliar file before editing
- Sharing a concise module summary with teammates
- Feeding structured module data into other tooling via `--json`
- Spotting complexity hot-spots without scanning entire documentation

### 4. Find Module

Find a module by name or pattern.

```bash
sdd doc find-module <name> [--pattern] [--docs-path PATH]
```

**Examples:**
```bash
# Find exact module
sdd doc find-module app/services/scoring.py

# Find modules matching pattern
sdd doc find-module ".*scoring.*" --pattern
```

**When to use:**
- Understanding module structure
- Finding all entities in a module
- Checking module dependencies
- Jumping into module descriptions via `describe-module`

### 5. Complexity Analysis

List functions above a complexity threshold.

```bash
sdd doc complexity [--threshold N] [--module M] [--docs-path PATH]
```

**Examples:**
```bash
# Find all functions with complexity >= 5
sdd doc complexity

# Find high-complexity functions (>= 8)
sdd doc complexity --threshold 8

# Find complex functions in a specific module
sdd doc complexity --module scoring.py
```

**When to use:**
- Identifying refactoring candidates
- Code quality assessment
- Planning technical debt reduction

### 5. Dependencies

Show module dependencies (direct or reverse).

```bash
sdd doc dependencies <module> [--reverse] [--docs-path PATH]
```

**Examples:**
```bash
# Show what a module imports
sdd doc dependencies app/services/scoring.py

# Show what imports this module (reverse dependencies)
sdd doc dependencies app/models/session.py --reverse
```

**When to use:**
- Impact analysis before changes
- Understanding module relationships
- Identifying circular dependencies
- Planning refactoring

### 6. Search

Search across all entities (classes, functions, modules).

```bash
sdd doc search <query> [--docs-path PATH]
```

**Examples:**
```bash
# Search for anything related to authentication
sdd doc search "auth"

# Search for scoring-related entities
sdd doc search "score.*"
```

**When to use:**
- Exploratory searches
- Finding all related entities
- Broad context gathering

### 7. Context

Gather comprehensive context for a feature area.

```bash
sdd doc context <area> [--docs-path PATH]
```

**Examples:**
```bash
# Get all entities related to wizard functionality
sdd doc context "wizard"

# Get all scoring-related context
sdd doc context "scoring"
```

**When to use:**
- Starting work on a feature area
- Understanding feature scope
- Gathering context for SDD tasks

### 8. Statistics

Show documentation statistics and metrics.

```bash
sdd doc stats [--docs-path PATH]
```

**When to use:**
- Quick codebase overview
- Assessing code quality
- Checking documentation freshness

### 9. List Entities

List all classes, functions, or modules.

```bash
sdd doc list-classes [--module M] [--docs-path PATH]
sdd doc list-functions [--module M] [--docs-path PATH]
sdd doc list-modules [--docs-path PATH]
```

**Examples:**
```bash
# List all classes
sdd doc list-classes

# List functions in a specific module
sdd doc list-functions --module scoring.py

# List all modules
sdd doc list-modules
```

**When to use:**
- Getting an overview of entities
- Browsing codebase structure
- Verifying documentation completeness

## Common Workflows

### Workflow 1: Starting a New Task

```bash
# 1. Get overview
sdd doc stats

# 2. Find relevant entities
sdd doc context "feature-name"

# 3. Check dependencies
sdd doc dependencies app/services/relevant_module.py
```

### Workflow 2: Bug Fixing

```bash
# 1. Find the function with the bug
sdd doc find-function problematic_function

# 2. Understand its module context
sdd doc find-module app/services/module.py

# 3. Check what depends on it
sdd doc dependencies app/services/module.py --reverse
```

### Workflow 3: Refactoring

```bash
# 1. Find high-complexity functions
sdd doc complexity --threshold 8

# 2. Analyze impact of refactoring
sdd doc dependencies app/services/complex_module.py --reverse

# 3. Find similar implementations for patterns
sdd doc search "similar_feature"
```

### Workflow 4: Feature Implementation

```bash
# 1. Find similar existing features
sdd doc search "similar.*feature" --pattern

# 2. Gather full context
sdd doc context "feature-area"
```

## Performance Notes

- All queries are fast (milliseconds) as they only read JSON
- No source code parsing or AST analysis
- Documentation is cached in memory during a query session
- For large codebases (>1000 files), queries remain performant

## Configuration

Default configuration in `config.yaml`:

```yaml
# Default paths
default_docs_path: "docs"  # Relative to project root

# Complexity thresholds
complexity:
  low: 1-3
  medium: 4-7
  high: 8-15
  very_high: 16+
  default_threshold: 5

# Search settings
search:
  max_results: 100
  include_docstrings: true
  case_sensitive: false

# Output settings
output:
  verbose: false
  format: "text"  # text or json
```

## Tips and Best Practices

1. **Always check documentation freshness** - Run `stats` to see when docs were generated
2. **Use patterns for exploration** - Regex patterns help find related entities
3. **Check impact before changes** - Use `dependencies --reverse` to understand impact
4. **Start with context gathering** - Use `context` command to get the big picture
5. **Integrate with SDD workflow** - Let SDD tools use `sdd_integration.py` for context
6. **Combine with other skills** - Use with `code-doc` for full workflow
7. **Use verbose mode for details** - Add `-v` flag for more information

## Limitations

- Only works with generated documentation (not live code)
- Requires documentation to be up-to-date
- Does not analyze runtime behavior
- Limited to Python codebases (via code-doc)
- Cannot detect issues in code logic (use code review tools)

## Integration with Other Skills

- **Skill(code-doc)**: Generates the documentation that `Skill(doc-query)` reads
- **Skill(sdd-plan)**: Uses `Skill(doc-query)` for context gathering during planning
- **Skill(sdd-next)**: Uses `Skill(doc-query)` to find relevant files for tasks
- **Skill(sdd-update)**: Uses `Skill(doc-query)` to verify task completion
- **Skill(run-tests)**: Can use `Skill(doc-query)` to find test files and coverage

## Troubleshooting

### Issue: "Documentation not found"
**Solution:** Run `Skill(code-doc)` skill first

### Issue: "Stale results"
**Solution:** Re-run `Skill(code-doc)` skill to refresh

### Issue: "No results found"
**Solution:** Check spelling, try pattern matching with `--pattern` flag

### Issue: "Import errors in Python scripts"
**Solution:** Ensure scripts are run from the correct directory or use full paths

## Examples

### Example 1: Starting work on authentication feature

```bash
# Get context
sdd doc context "auth"

# Find similar implementations
sdd doc search "auth.*"

# Check dependencies
sdd doc dependencies app/services/auth.py
```

### Example 2: Refactoring high-complexity code

```bash
# Find candidates
sdd doc complexity --threshold 10

# Analyze impact
sdd doc dependencies app/services/complex_module.py --reverse
```

### Example 3: Bug fix in scoring logic

```bash
# Find the function
sdd doc find-function calculate_final_score

# Get module context
sdd doc find-module scoring.py

# Check what depends on it
sdd doc dependencies app/services/scoring.py --reverse
```

---

*For more information on generating documentation, see the `Skill(code-doc)` skill.*
*For spec-driven development workflows, see `Skill(sdd-plan)`, `Skill(sdd-next)`, and `Skill(sdd-update)` skills.*
