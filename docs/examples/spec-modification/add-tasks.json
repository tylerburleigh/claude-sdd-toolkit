{
  "description": "Example: Adding new tasks to an existing spec",
  "scenario": "During implementation of a user authentication feature, you discover that input validation tasks are missing from the original spec. This example shows how to add those tasks with proper dependencies.",
  "original_spec_excerpt": {
    "phase-2": {
      "id": "phase-2",
      "title": "Authentication Service",
      "tasks": {
        "task-2-1": {
          "id": "task-2-1",
          "title": "Create AuthService class",
          "description": "Core authentication service with login/logout",
          "type": "task",
          "status": "completed",
          "metadata": {
            "file_path": "src/services/authService.ts",
            "estimated_hours": 3
          }
        },
        "task-2-2": {
          "id": "task-2-2",
          "title": "Add JWT token generation",
          "description": "Generate and sign JWT tokens",
          "type": "task",
          "status": "in_progress",
          "dependencies": {
            "blocked_by": ["task-2-1"]
          },
          "metadata": {
            "file_path": "src/services/tokenService.ts",
            "estimated_hours": 2
          }
        }
      }
    }
  },
  "modification_steps": [
    {
      "step": 1,
      "action": "Add new tasks for input validation",
      "reasoning": "Discovered during implementation that user input validation is critical for security but wasn't in original spec"
    },
    {
      "step": 2,
      "action": "Set proper dependencies",
      "reasoning": "Validation must happen before authentication logic runs"
    },
    {
      "step": 3,
      "action": "Update existing task dependencies",
      "reasoning": "task-2-2 should now depend on validation tasks"
    }
  ],
  "modified_spec_excerpt": {
    "phase-2": {
      "id": "phase-2",
      "title": "Authentication Service",
      "tasks": {
        "task-2-1": {
          "id": "task-2-1",
          "title": "Create AuthService class",
          "description": "Core authentication service with login/logout",
          "type": "task",
          "status": "completed",
          "metadata": {
            "file_path": "src/services/authService.ts",
            "estimated_hours": 3
          }
        },
        "task-2-1-1": {
          "id": "task-2-1-1",
          "title": "Create input validators",
          "description": "Email and password validation utilities",
          "type": "task",
          "status": "pending",
          "dependencies": {
            "blocked_by": []
          },
          "metadata": {
            "file_path": "src/utils/validators.ts",
            "estimated_hours": 1.5,
            "task_category": "implementation",
            "parallel_safe": true
          }
        },
        "task-2-1-2": {
          "id": "task-2-1-2",
          "title": "Add validation middleware",
          "description": "Middleware to validate auth requests",
          "type": "task",
          "status": "pending",
          "dependencies": {
            "blocked_by": ["task-2-1-1"]
          },
          "metadata": {
            "file_path": "src/middleware/validation.ts",
            "estimated_hours": 2,
            "task_category": "implementation"
          }
        },
        "task-2-2": {
          "id": "task-2-2",
          "title": "Add JWT token generation",
          "description": "Generate and sign JWT tokens",
          "type": "task",
          "status": "in_progress",
          "dependencies": {
            "blocked_by": ["task-2-1", "task-2-1-2"]
          },
          "metadata": {
            "file_path": "src/services/tokenService.ts",
            "estimated_hours": 2
          }
        }
      }
    }
  },
  "validation_command": "Task(subagent_type: 'sdd-toolkit:sdd-validate-subagent', prompt: 'Validate specs/active/user-auth-001.json after adding validation tasks', description: 'Validate spec')",
  "journal_entry": {
    "command": "Task(subagent_type: 'sdd-toolkit:sdd-update-subagent', prompt: 'Add journal entry to phase phase-2 in user-auth-001. Entry: Added input validation tasks (task-2-1-1, task-2-1-2) discovered during implementation. Security requirement not captured in original spec. Updated task-2-2 dependency to ensure validation happens first.', description: 'Document spec addition')",
    "entry_content": "Added input validation tasks (task-2-1-1, task-2-1-2) discovered during implementation. Security requirement not captured in original spec. Updated task-2-2 dependency to ensure validation happens first."
  },
  "key_points": [
    "New tasks inserted with proper ID numbering (task-2-1-1, task-2-1-2)",
    "Dependencies updated to reflect new task order",
    "parallel_safe flag set for task-2-1-1 (can run in parallel)",
    "Journal entry documents why tasks were added",
    "Validation run after modification to check for errors"
  ],
  "common_pitfalls": [
    {
      "pitfall": "Forgetting to update dependencies",
      "consequence": "Existing tasks may start before new prerequisites complete",
      "fix": "Review all tasks in the phase and update blocked_by arrays"
    },
    {
      "pitfall": "Using inconsistent ID numbering",
      "consequence": "Spec becomes hard to navigate and maintain",
      "fix": "Follow pattern: task-{phase}-{sequence} or task-{parent}-{sequence}"
    },
    {
      "pitfall": "Skipping validation after changes",
      "consequence": "Circular dependencies or broken references may go unnoticed",
      "fix": "Always run sdd-validate after manual spec edits"
    }
  ]
}
