{
  "spec_id": "compact-json-output-2025-11-03-001",
  "generated": "2025-11-03T00:00:00Z",
  "last_updated": "2025-11-03T21:40:55.750335Z",
  "hierarchy": {
    "spec-root": {
      "type": "spec",
      "title": "Compact JSON Output for SDD CLI Commands",
      "status": "in_progress",
      "parent": null,
      "children": [
        "phase-1",
        "phase-2",
        "phase-3",
        "phase-4"
      ],
      "total_tasks": 38,
      "completed_tasks": 2,
      "metadata": {
        "description": "Implement contract-based compact JSON output to achieve 65-85% token savings for agent workflows while maintaining backward compatibility",
        "objectives": [
          "Add --compact flag to 5 main CLI commands (prepare-task, task-info, check-deps, progress, next-task)",
          "Implement contract-based field extraction preserving functional completeness",
          "Achieve 65-85% token savings in agent workflows",
          "Maintain 100% backward compatibility in Phase 1",
          "Create clear migration path for v2.0 default change"
        ],
        "success_criteria": [
          "All 5 commands support --compact flag",
          "Token savings verified at 65-85% for each command",
          "All existing sdd-next workflows pass with compact output",
          "Contract definitions formally documented",
          "Migration guide complete"
        ]
      }
    },
    "phase-1": {
      "type": "phase",
      "title": "Contract Infrastructure & Utilities",
      "status": "in_progress",
      "parent": "spec-root",
      "children": [
        "phase-1-files",
        "phase-1-verify"
      ],
      "total_tasks": 11,
      "completed_tasks": 2,
      "metadata": {
        "purpose": "Create shared infrastructure for contract-based JSON output formatting",
        "estimated_hours": 6,
        "risk_level": "low"
      },
      "dependencies": {
        "blocks": [
          "phase-2"
        ]
      }
    },
    "phase-1-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "in_progress",
      "parent": "phase-1",
      "children": [
        "task-1-1",
        "task-1-2",
        "task-1-3"
      ],
      "total_tasks": 6,
      "completed_tasks": 2,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-1-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-1": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/common/contracts.py",
      "status": "in_progress",
      "parent": "phase-1-files",
      "children": [
        "task-1-1-1",
        "task-1-1-2",
        "task-1-1-3"
      ],
      "dependencies": {
        "blocks": [
          "task-1-2",
          "task-2-1",
          "task-2-2",
          "task-2-3",
          "task-2-4",
          "task-2-5",
          "task-1-3"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 2,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/common/contracts.py",
        "task_category": "implementation",
        "estimated_hours": 3,
        "details": "Create new module containing contract extraction functions for all 5 command types"
      }
    },
    "task-1-1-1": {
      "type": "subtask",
      "title": "Implement extract_prepare_task_contract()",
      "status": "completed",
      "parent": "task-1-1",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "details": "Extract fields: task_id, title, can_start, blocked_by, git{needs_branch, suggested_branch, dirty}, spec_complete. Optional: file_path, details, validation_warnings",
        "started_at": "2025-11-03T21:36:59.613366Z",
        "completed_at": "2025-11-03T21:38:23.605412Z",
        "needs_journaling": false,
        "actual_hours": 0.023,
        "journaled_at": "2025-11-03T21:38:23.611767Z"
      }
    },
    "task-1-1-2": {
      "type": "subtask",
      "title": "Implement extract_task_info_contract(), extract_check_deps_contract(), extract_progress_contract(), extract_next_task_contract()",
      "status": "completed",
      "parent": "task-1-1",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "details": "Implement remaining 4 contract extractors following functional contract specifications from /tmp/functional-contracts-analysis.md",
        "started_at": "2025-11-03T21:39:03.108953Z",
        "completed_at": "2025-11-03T21:40:55.737612Z",
        "needs_journaling": false,
        "actual_hours": 0.031,
        "journaled_at": "2025-11-03T21:40:55.747896Z"
      }
    },
    "task-1-1-3": {
      "type": "subtask",
      "title": "Add contract documentation and type hints",
      "status": "pending",
      "parent": "task-1-1",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Document each contract function with purpose, decisions enabled, required fields, and optional fields with inclusion conditions"
      }
    },
    "task-1-2": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/common/json_output.py",
      "status": "pending",
      "parent": "phase-1-files",
      "children": [
        "task-1-2-1",
        "task-1-2-2"
      ],
      "dependencies": {
        "blocks": [
          "task-2-1",
          "task-2-2",
          "task-2-3",
          "task-2-4",
          "task-2-5",
          "task-1-3"
        ],
        "blocked_by": [
          "task-1-1"
        ],
        "depends": []
      },
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/common/json_output.py",
        "task_category": "implementation",
        "estimated_hours": 2,
        "details": "Create utility module for JSON output formatting with compact support"
      }
    },
    "task-1-2-1": {
      "type": "subtask",
      "title": "Implement format_json_output() helper function",
      "status": "pending",
      "parent": "task-1-2",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Central function accepting data, compact flag, command_type. Returns formatted JSON string. Uses json.dumps with indent=2 (pretty) or separators=(',',':') (minified)"
      }
    },
    "task-1-2-2": {
      "type": "subtask",
      "title": "Add print_json_output() convenience function",
      "status": "pending",
      "parent": "task-1-2",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Wrapper that calls format_json_output() and prints result. Simplifies CLI command updates"
      }
    },
    "task-1-3": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/common/__init__.py",
      "status": "pending",
      "parent": "phase-1-files",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-1-1",
          "task-1-2"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/common/__init__.py",
        "task_category": "implementation",
        "estimated_hours": 0.5,
        "details": "Export format_json_output, print_json_output, and contract extraction functions"
      }
    },
    "phase-1-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-1",
      "children": [
        "verify-1-1",
        "verify-1-2",
        "verify-1-3",
        "verify-1-4",
        "verify-1-5"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-1-files"
        ],
        "depends": []
      },
      "total_tasks": 5,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-1-1": {
      "type": "verify",
      "title": "Contract extractors return expected fields",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "python -c \"from claude_skills.common.contracts import extract_prepare_task_contract; print(extract_prepare_task_contract.__name__)\"",
        "expected": "Function imports successfully"
      }
    },
    "verify-1-2": {
      "type": "verify",
      "title": "format_json_output produces valid JSON",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "python -c \"from claude_skills.common.json_output import format_json_output; import json; result = format_json_output({'test': 123}, compact=True); json.loads(result)\"",
        "expected": "JSON parses without errors"
      }
    },
    "verify-1-3": {
      "type": "verify",
      "title": "Compact output is minified (no indentation)",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "python -c \"from claude_skills.common.json_output import format_json_output; result = format_json_output({'a': 1, 'b': 2}, compact=True); assert '\\n' not in result\"",
        "expected": "Compact output contains no newlines"
      }
    },
    "verify-1-4": {
      "type": "verify",
      "title": "Verbose output is pretty-printed",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "python -c \"from claude_skills.common.json_output import format_json_output; result = format_json_output({'a': 1, 'b': 2}, compact=False); assert '\\n' in result\"",
        "expected": "Verbose output contains newlines (indented)"
      }
    },
    "verify-1-5": {
      "type": "verify",
      "title": "All exports available from common module",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "python -c \"from claude_skills.common import format_json_output, print_json_output; print('OK')\"",
        "expected": "Imports succeed without errors"
      }
    },
    "phase-2": {
      "type": "phase",
      "title": "CLI Command Integration",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-2-files",
        "phase-2-verify"
      ],
      "dependencies": {
        "blocks": [
          "phase-3"
        ],
        "blocked_by": [
          "phase-1"
        ],
        "depends": []
      },
      "total_tasks": 12,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Integrate compact output into all 5 main CLI commands",
        "estimated_hours": 8,
        "risk_level": "medium"
      }
    },
    "phase-2-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-2",
      "children": [
        "task-2-1",
        "task-2-2",
        "task-2-3",
        "task-2-4",
        "task-2-5",
        "task-2-6"
      ],
      "total_tasks": 6,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-2-verify"
        ]
      }
    },
    "task-2-1": {
      "type": "task",
      "title": "Update cmd_prepare_task() for compact output",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-2-6"
        ],
        "blocked_by": [
          "task-1-1",
          "task-1-2"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/sdd_next/cli.py",
        "task_category": "refactoring",
        "estimated_hours": 1,
        "details": "Add --compact flag to argparse. Replace json.dumps() calls with print_json_output(task_prep, compact=args.compact, command_type='prepare-task')"
      }
    },
    "task-2-2": {
      "type": "task",
      "title": "Update cmd_task_info() for compact output",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-2-6"
        ],
        "blocked_by": [
          "task-1-1",
          "task-1-2"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/sdd_next/cli.py",
        "task_category": "refactoring",
        "estimated_hours": 1,
        "details": "Add --compact flag to argparse. Replace json.dumps() with print_json_output(task_data, compact=args.compact, command_type='task-info')"
      }
    },
    "task-2-3": {
      "type": "task",
      "title": "Update cmd_check_deps() for compact output",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-2-6"
        ],
        "blocked_by": [
          "task-1-1",
          "task-1-2"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/sdd_next/cli.py",
        "task_category": "refactoring",
        "estimated_hours": 1,
        "details": "Add --compact flag to argparse. Replace json.dumps() with print_json_output(deps, compact=args.compact, command_type='check-deps')"
      }
    },
    "task-2-4": {
      "type": "task",
      "title": "Update cmd_progress() for compact output",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-2-6"
        ],
        "blocked_by": [
          "task-1-1",
          "task-1-2"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/sdd_next/cli.py",
        "task_category": "refactoring",
        "estimated_hours": 1,
        "details": "Add --compact flag to argparse. Replace json.dumps() with print_json_output(progress, compact=args.compact, command_type='progress')"
      }
    },
    "task-2-5": {
      "type": "task",
      "title": "Update cmd_next_task() for compact output",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-2-6"
        ],
        "blocked_by": [
          "task-1-1",
          "task-1-2"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/sdd_next/cli.py",
        "task_category": "refactoring",
        "estimated_hours": 1,
        "details": "Add --compact flag to argparse (in register_next function). Replace json.dumps() with print_json_output(task_data, compact=args.compact, command_type='next-task')"
      }
    },
    "task-2-6": {
      "type": "task",
      "title": "Update CLI help text for all 5 commands",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-2-1",
          "task-2-2",
          "task-2-3",
          "task-2-4",
          "task-2-5"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/sdd_next/cli.py",
        "task_category": "implementation",
        "estimated_hours": 0.5,
        "details": "Add help text for --compact flag: 'Output compact JSON (minified, essential fields only). Achieves 65-85% token savings.'"
      }
    },
    "phase-2-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-2",
      "children": [
        "verify-2-1",
        "verify-2-2",
        "verify-2-3",
        "verify-2-4",
        "verify-2-5",
        "verify-2-6"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-2-files"
        ],
        "depends": []
      },
      "total_tasks": 6,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-2-1": {
      "type": "verify",
      "title": "prepare-task --compact produces valid JSON",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "sdd prepare-task semantic-search-2025-10-24-001 --json --compact | python -m json.tool > /dev/null",
        "expected": "JSON parses without errors"
      }
    },
    "verify-2-2": {
      "type": "verify",
      "title": "All 5 commands support --compact flag",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "sdd prepare-task --help | grep -q compact && sdd task-info --help | grep -q compact && sdd check-deps --help | grep -q compact && sdd progress --help | grep -q compact && sdd next-task --help | grep -q compact && echo 'All commands support --compact'",
        "expected": "All 5 commands have --compact in help text"
      }
    },
    "verify-2-3": {
      "type": "verify",
      "title": "Compact output is minified (single line)",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "lines=$(sdd prepare-task semantic-search-2025-10-24-001 --json --compact 2>/dev/null | wc -l); [ $lines -eq 1 ] && echo 'Compact output is single line'",
        "expected": "Output is exactly 1 line"
      }
    },
    "verify-2-4": {
      "type": "verify",
      "title": "Non-compact output still works (backward compatible)",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "sdd prepare-task semantic-search-2025-10-24-001 --json | python -m json.tool > /dev/null",
        "expected": "Default behavior unchanged (pretty JSON)"
      }
    },
    "verify-2-5": {
      "type": "verify",
      "title": "Compact output smaller than verbose",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "compact_size=$(sdd prepare-task semantic-search-2025-10-24-001 --json --compact 2>/dev/null | wc -c); verbose_size=$(sdd prepare-task semantic-search-2025-10-24-001 --json 2>/dev/null | wc -c); [ $compact_size -lt $verbose_size ] && echo \"Compact is smaller: $compact_size < $verbose_size\"",
        "expected": "Compact output byte count is less than verbose"
      }
    },
    "verify-2-6": {
      "type": "verify",
      "title": "Help text updated for all commands",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "expected": "Review help text for prepare-task, task-info, check-deps, progress, next-task to confirm --compact flag is documented",
        "command": ""
      }
    },
    "phase-3": {
      "type": "phase",
      "title": "Token Efficiency Validation",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-3-files",
        "phase-3-verify"
      ],
      "dependencies": {
        "blocks": [
          "phase-4"
        ],
        "blocked_by": [
          "phase-2"
        ],
        "depends": []
      },
      "total_tasks": 8,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Measure and verify token savings meet 65-85% target",
        "estimated_hours": 4,
        "risk_level": "low"
      }
    },
    "phase-3-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-3",
      "children": [
        "task-3-1",
        "task-3-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-3-verify"
        ]
      }
    },
    "task-3-1": {
      "type": "task",
      "title": "Create token measurement script",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [],
      "dependencies": {
        "blocks": [
          "verify-3-1",
          "verify-3-2",
          "verify-3-3",
          "verify-3-4"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "scripts/measure_token_efficiency.py",
        "task_category": "implementation",
        "estimated_hours": 2,
        "details": "Script to run all 5 commands with --compact and without, measure token counts using tiktoken, calculate savings percentage"
      }
    },
    "task-3-2": {
      "type": "task",
      "title": "Document token savings in README",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "verify-3-1",
          "verify-3-2",
          "verify-3-3"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "README.md",
        "task_category": "implementation",
        "estimated_hours": 1,
        "details": "Add section documenting --compact flag usage, token savings by command, and use cases"
      }
    },
    "phase-3-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-3",
      "children": [
        "verify-3-1",
        "verify-3-2",
        "verify-3-3",
        "verify-3-4",
        "verify-3-5",
        "verify-3-6"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-3-files"
        ],
        "depends": []
      },
      "total_tasks": 6,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-3-1": {
      "type": "verify",
      "title": "prepare-task achieves 65-70% token savings",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-3-2"
        ],
        "blocked_by": [
          "task-3-1"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "python scripts/measure_token_efficiency.py prepare-task semantic-search-2025-10-24-001",
        "expected": "Savings between 65-70% (target: 67.4%)"
      }
    },
    "verify-3-2": {
      "type": "verify",
      "title": "task-info achieves 85-90% token savings",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-3-2"
        ],
        "blocked_by": [
          "task-3-1"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "python scripts/measure_token_efficiency.py task-info semantic-search-2025-10-24-001 task-1-1-1",
        "expected": "Savings between 85-90% (target: 88.7%)"
      }
    },
    "verify-3-3": {
      "type": "verify",
      "title": "All 5 commands meet minimum 55% savings target",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-3-2"
        ],
        "blocked_by": [
          "task-3-1"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "python scripts/measure_token_efficiency.py --all-commands semantic-search-2025-10-24-001 --min-savings 55",
        "expected": "All commands exceed 55% token savings"
      }
    },
    "verify-3-4": {
      "type": "verify",
      "title": "Token measurement script runs without errors",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-3-1"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "python scripts/measure_token_efficiency.py --help",
        "expected": "Script shows usage information"
      }
    },
    "verify-3-5": {
      "type": "verify",
      "title": "Workflow scenario measurements documented",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "expected": "Measure single task (4 commands), 5-task autonomous (26 commands), and 20-task workflows. Verify 65-85% savings in real scenarios",
        "command": ""
      }
    },
    "verify-3-6": {
      "type": "verify",
      "title": "README documents compact flag usage",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "expected": "README includes examples, token savings table, and migration guidance",
        "command": ""
      }
    },
    "phase-4": {
      "type": "phase",
      "title": "sdd-next Integration & Migration Guide",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-4-files",
        "phase-4-verify"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-3"
        ],
        "depends": []
      },
      "total_tasks": 7,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Update sdd-next SKILL.md to use compact output and create migration guide for v2.0",
        "estimated_hours": 3,
        "risk_level": "low"
      }
    },
    "phase-4-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-4",
      "children": [
        "task-4-1",
        "task-4-2",
        "task-4-3"
      ],
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-4-verify"
        ]
      }
    },
    "task-4-1": {
      "type": "task",
      "title": "Update sdd-next SKILL.md command examples",
      "status": "pending",
      "parent": "phase-4-files",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "skills/sdd-next/SKILL.md",
        "task_category": "implementation",
        "estimated_hours": 1,
        "details": "Add --compact flag to all CLI command examples in workflow sections (prepare-task, task-info, check-deps, progress, next-task)"
      }
    },
    "task-4-2": {
      "type": "task",
      "title": "Create MIGRATION.md guide",
      "status": "pending",
      "parent": "phase-4-files",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "docs/MIGRATION_V2.md",
        "task_category": "implementation",
        "estimated_hours": 1.5,
        "details": "Document Phase 1 (opt-in --compact), Phase 2 (v2.0 default change), backward compatibility with --verbose flag, and migration timeline"
      }
    },
    "task-4-3": {
      "type": "task",
      "title": "Create contract documentation",
      "status": "pending",
      "parent": "phase-4-files",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "docs/CONTRACTS.md",
        "task_category": "implementation",
        "estimated_hours": 1,
        "details": "Document functional contracts for all 5 commands with required/optional fields, decisions enabled, and inclusion conditions"
      }
    },
    "phase-4-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-4",
      "children": [
        "verify-4-1",
        "verify-4-2",
        "verify-4-3",
        "verify-4-4"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-4-files"
        ],
        "depends": []
      },
      "total_tasks": 4,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-4-1": {
      "type": "verify",
      "title": "sdd-next workflows work with compact output",
      "status": "pending",
      "parent": "phase-4-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "expected": "Run complete sdd-next workflow (prepare-task \u2192 implement \u2192 update) using --compact flag. Verify all information needed for decisions is present",
        "command": ""
      }
    },
    "verify-4-2": {
      "type": "verify",
      "title": "Migration guide is complete and clear",
      "status": "pending",
      "parent": "phase-4-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "expected": "Review MIGRATION_V2.md for completeness: Phase 1 instructions, Phase 2 breaking changes, backward compatibility notes, timeline",
        "command": ""
      }
    },
    "verify-4-3": {
      "type": "verify",
      "title": "Contract documentation matches implementation",
      "status": "pending",
      "parent": "phase-4-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "expected": "Compare CONTRACTS.md against actual contract extractor implementations. Verify field lists are accurate and complete",
        "command": ""
      }
    },
    "verify-4-4": {
      "type": "verify",
      "title": "All sdd-next SKILL.md examples use compact",
      "status": "pending",
      "parent": "phase-4-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "expected": "Grep SKILL.md for command examples. Verify all 5 commands include --compact flag in workflow sections",
        "command": ""
      }
    }
  },
  "journal": [
    {
      "timestamp": "2025-11-03T21:38:23.611749Z",
      "entry_type": "status_change",
      "title": "Task Completed: Implement extract_prepare_task_contract()",
      "author": "claude-code",
      "content": "Successfully implemented extract_prepare_task_contract() function in src/claude_skills/claude_skills/common/contracts.py. The function extracts minimal contracts from prepare-task output with these achievements:\n\n1. **All essential fields included**: task_id, title, can_start, blocked_by, git object (needs_branch, suggested_branch, dirty), spec_complete\n2. **Smart conditional inclusion**: file_path and details included only when present, status only if not \"pending\", validation_warnings only if non-empty, completion_info only if spec complete\n3. **Proper omissions**: Redundant fields (success, error, task_data, repo_root, UI-only fields) correctly excluded\n4. **Comprehensive documentation**: Detailed docstring explaining purpose, field inclusion rules, and examples\n5. **Type hints**: Full type annotations using Dict[str, Any]\n6. **Verified with real data**: Tested with actual prepare-task output, achieved 62.5% token savings\n\nThe implementation follows the functional contract specification from /tmp/functional-contracts-analysis.md and successfully reduces token usage while preserving all decision-enabling information for the agent.",
      "metadata": {},
      "task_id": "task-1-1-1"
    },
    {
      "timestamp": "2025-11-03T21:39:06.648588Z",
      "entry_type": "note",
      "title": "Implementation Started: Contract Extraction Functions",
      "author": "claude-code",
      "content": "Beginning implementation of the remaining 4 contract extraction functions: extract_task_info_contract(), extract_check_deps_contract(), extract_progress_contract(), and extract_next_task_contract(). These functions will follow the established contract extraction pattern and integrate with the overall contract-based JSON output system.",
      "metadata": {},
      "task_id": "task-1-1-2"
    },
    {
      "timestamp": "2025-11-03T21:40:55.747877Z",
      "entry_type": "status_change",
      "title": "Task Completed: Implement extract_task_info_contract(), extract_check_deps_contract(), extract_progress_contract(), extract_next_task_contract()",
      "author": "claude-code",
      "content": "Successfully implemented all 4 remaining contract extraction functions in src/claude_skills/claude_skills/common/contracts.py:\n\n1. **extract_task_info_contract()**: Extracts task_id, title, status, blocked_by, blocks, and optional file_path. Token savings: 75.7% (37\u21929 tokens)\n\n2. **extract_check_deps_contract()**: Extracts can_start with conditional blocked_by/blocks arrays. Minimal case is just {\"can_start\": true}. Token savings: 80% (10\u21922 tokens)\n\n3. **extract_progress_contract()**: Extracts total, completed, in_progress, pending counts. Token savings: 77.8% (36\u21928 tokens)\n\n4. **extract_next_task_contract()**: Extracts only task_id and title. Token savings: 42.9% (14\u21928 tokens)\n\nAll functions:\n- Follow functional contract specifications from /tmp/functional-contracts-analysis.md\n- Include comprehensive docstrings with purpose, field inclusion rules, and examples\n- Have full type annotations (Dict[str, Any] \u2192 Dict[str, Any])\n- Tested successfully with real CLI command outputs\n- Implement smart defaults (omit null/empty values, conditional inclusion)\n\nAverage token savings across all 4 functions: ~69%",
      "metadata": {},
      "task_id": "task-1-1-2"
    }
  ],
  "metadata": {
    "progress_percentage": 5,
    "status": "active",
    "current_phase": "phase-1",
    "git": {
      "branch_name": null,
      "base_branch": null,
      "commits": [
        {
          "sha": "ed0e37fa861b1c83b63b1d489c956a12bb364d08",
          "message": "task-1-1-2: Implement extract_task_info_contract(), extract_check_deps_contract(), extract_progress_contract(), extract_next_task_contract()",
          "task_id": "task-1-1-2",
          "timestamp": "2025-11-03T21:40:55.869487Z"
        }
      ],
      "pr": null
    }
  }
}