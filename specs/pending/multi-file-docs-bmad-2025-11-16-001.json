{
  "spec_id": "multi-file-docs-bmad-2025-11-16-001",
  "generated": "2025-11-16T22:30:00Z",
  "last_updated": "2025-11-16T22:15:20.028241Z",
  "hierarchy": {
    "spec-root": {
      "type": "spec",
      "title": "Multi-File Documentation with BMAD-Informed Discovery Protocol",
      "status": "pending",
      "parent": null,
      "children": [
        "phase-1",
        "phase-2",
        "phase-3",
        "phase-4"
      ],
      "total_tasks": 66,
      "completed_tasks": 0,
      "metadata": {
        "description": "Transform code-doc from single-file to multi-file output with INDEX_GUIDED discovery protocol for 60-70% context reduction. Incorporates BMAD patterns to address review feedback: defines core logic upfront, builds in backward compatibility, specifies discovery protocol with error transparency.",
        "objectives": [
          "Implement multi-file Markdown output with BMAD-defined index.md structure (7 sections)",
          "Create discovery protocol with dual format support and explicit error handling",
          "Add project type detection (4-5 types) and write-as-you-go memory optimization",
          "Migrate all workflows to use discovery protocol with zero manual file reads"
        ],
        "success_criteria": [
          "60%+ context reduction measured on 3 sample projects (small, medium, large)",
          "All tests pass with <20% performance regression",
          "100% of workflows using {code_doc_content} variables (zero manual Read calls)",
          "Successfully processes projects >1000 files with <500MB peak memory"
        ],
        "reference_docs": [
          "analysis/doc-improvements.md",
          "analysis/high-leverage-improvements.md",
          "analysis/bmad-document-access-mechanism.md",
          "analysis/code-doc-vs-document-project-comparison.md",
          "/home/tyler/Downloads/BMAD-METHOD-main/src/modules/bmm/workflows/document-project/templates/index-template.md"
        ],
        "bmad_patterns": [
          "index.md template structure (7 sections)",
          "INDEX_GUIDED discovery protocol",
          "Error transparency with explicit logging",
          "Dual format support (new + legacy fallback)"
        ],
        "improvements_over_original": [
          "index.md structure fully defined using BMAD template (addresses: undefined core logic)",
          "Backward compatibility built-in from Phase 1 (addresses: unacceptable clean break)",
          "Discovery protocol completely specified (addresses: vague migration plan)",
          "All error scenarios defined with explicit warnings (addresses: silent failure mode)",
          "Realistic time estimates with justification (addresses: unrealistic estimates)"
        ]
      }
    },
    "phase-1": {
      "type": "phase",
      "title": "Multi-File Foundation with Backward Compatibility",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-1-investigation",
        "phase-1-files",
        "phase-1-verify"
      ],
      "total_tasks": 18,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Replace single-file output with multi-file structure while maintaining legacy format support. Define index.md template structure completely using BMAD patterns.",
        "risk_level": "medium",
        "estimated_duration": "3-4 days",
        "key_deliverables": [
          "index.md with 7 BMAD sections fully defined",
          "Shard generators for statistics, classes, functions, dependencies, cross-references",
          "--single-file flag for backward compatibility",
          "Write-as-you-go pattern implementation",
          "60%+ token reduction validated on 3 projects"
        ]
      },
      "dependencies": {
        "blocks": [
          "phase-2"
        ]
      }
    },
    "phase-1-investigation": {
      "type": "group",
      "title": "Template Analysis & Requirements Definition",
      "status": "pending",
      "parent": "phase-1",
      "children": [
        "task-1-1",
        "task-1-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-1-files"
        ]
      }
    },
    "task-1-1": {
      "type": "task",
      "title": "Analyze BMAD index-template.md and define exact index.md structure",
      "status": "pending",
      "parent": "phase-1-investigation",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "research",
        "estimated_hours": 2,
        "reference_files": [
          "/home/tyler/Downloads/BMAD-METHOD-main/src/modules/bmm/workflows/document-project/templates/index-template.md",
          "analysis/bmad-document-access-mechanism.md"
        ],
        "deliverables": [
          "7-section index.md structure specification",
          "Template variable definitions (project_name, primary_languages, etc.)",
          "Target token size: 3-7k tokens",
          "Section content requirements for each of 7 sections"
        ],
        "sections_to_define": [
          "1. Project Header (name, languages, frameworks, timestamp)",
          "2. Project Overview (2-3 paragraph description)",
          "3. Quick Reference (file/class/function counts, entry point, tech stack)",
          "4. Documentation Files (links to shards with descriptions)",
          "5. For AI-Assisted Development (usage guidance by feature type)",
          "6. Machine-Readable Documentation (link to JSON)",
          "7. Optional: Project Structure (for multi-part projects - future enhancement)"
        ]
      },
      "dependencies": {
        "blocks": [
          "task-1-3"
        ]
      }
    },
    "task-1-2": {
      "type": "task",
      "title": "Analyze current formatter.py and plan shard extraction strategy",
      "status": "pending",
      "parent": "phase-1-investigation",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "investigation",
        "estimated_hours": 1,
        "focus_areas": [
          "MarkdownGenerator class current structure",
          "How sections are currently generated (statistics, classes, functions, etc.)",
          "File writing mechanisms and output paths",
          "Integration with generator.py"
        ],
        "deliverables": [
          "List of existing section generators to extract",
          "Shard file naming convention",
          "Write-as-you-go implementation points"
        ]
      },
      "dependencies": {
        "blocks": [
          "task-1-3"
        ]
      }
    },
    "phase-1-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-1",
      "children": [
        "task-1-3",
        "task-1-4",
        "task-1-5",
        "task-1-6",
        "task-1-7",
        "task-1-8"
      ],
      "total_tasks": 13,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocked_by": [
          "phase-1-investigation"
        ],
        "blocks": [
          "phase-1-verify"
        ]
      }
    },
    "task-1-3": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/code_doc/formatter.py",
      "status": "pending",
      "parent": "phase-1-files",
      "children": [
        "task-1-3-1",
        "task-1-3-2",
        "task-1-3-3",
        "task-1-3-4",
        "task-1-3-5",
        "task-1-3-6"
      ],
      "total_tasks": 6,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/code_doc/formatter.py",
        "task_category": "implementation",
        "estimated_hours": 8,
        "changes_summary": "Add multi-file generation capability with BMAD index.md template and shard generators"
      },
      "dependencies": {
        "blocked_by": [
          "task-1-1",
          "task-1-2"
        ],
        "blocks": [
          "task-1-4",
          "task-1-6"
        ]
      }
    },
    "task-1-3-1": {
      "type": "subtask",
      "title": "Add generate_multi_file() orchestration method",
      "status": "pending",
      "parent": "task-1-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "New method that orchestrates creation of all shard files with write-as-you-go pattern. Returns dict mapping filenames to content. Implements incremental writing to prevent memory exhaustion.",
        "estimated_hours": 1
      }
    },
    "task-1-3-2": {
      "type": "subtask",
      "title": "Implement _generate_index() using BMAD 7-section template",
      "status": "pending",
      "parent": "task-1-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Create index.md with exact BMAD structure: 1) Project Header, 2) Project Overview, 3) Quick Reference (tech stack, entry point, architecture), 4) Documentation Files (links to shards with descriptions), 5) For AI-Assisted Development (guidance by feature type), 6) Machine-Readable (link to JSON). Target: 3-7k tokens.",
        "template_variables": [
          "{project_name}",
          "{primary_languages}",
          "{detected_frameworks}",
          "{file_count}",
          "{class_count}",
          "{function_count}",
          "{entry_point}",
          "{timestamp}"
        ],
        "estimated_hours": 3,
        "reference": "BMAD index-template.md structure"
      }
    },
    "task-1-3-3": {
      "type": "subtask",
      "title": "Implement _generate_statistics_file() shard extractor",
      "status": "pending",
      "parent": "task-1-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Extract existing statistics section generation into dedicated shard file generator. Write immediately and clear detailed data.",
        "estimated_hours": 1
      }
    },
    "task-1-3-4": {
      "type": "subtask",
      "title": "Implement _generate_classes_file() and _generate_functions_file() extractors",
      "status": "pending",
      "parent": "task-1-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Extract existing classes and functions section generation into separate shard files. Apply write-as-you-go pattern.",
        "estimated_hours": 2
      }
    },
    "task-1-3-5": {
      "type": "subtask",
      "title": "Implement _generate_dependencies_file() and _generate_cross_references_file()",
      "status": "pending",
      "parent": "task-1-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Create dedicated shard files for dependencies and cross-references sections.",
        "estimated_hours": 1
      }
    },
    "task-1-3-6": {
      "type": "subtask",
      "title": "Keep generate() method with --single-file flag support",
      "status": "pending",
      "parent": "task-1-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Maintain backward compatibility: keep single-file generation as fallback when --single-file flag provided. Multi-file is default, not exclusive.",
        "estimated_hours": 0.5
      }
    },
    "task-1-4": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/code_doc/generator.py",
      "status": "pending",
      "parent": "phase-1-files",
      "children": [
        "task-1-4-1",
        "task-1-4-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/code_doc/generator.py",
        "task_category": "implementation",
        "estimated_hours": 2,
        "changes_summary": "Update DocumentationGenerator to orchestrate multi-file output with write-as-you-go"
      },
      "dependencies": {
        "blocked_by": [
          "task-1-3"
        ],
        "blocks": [
          "task-1-5",
          "task-1-7"
        ]
      }
    },
    "task-1-4-1": {
      "type": "subtask",
      "title": "Update save_markdown() to use generate_multi_file() by default",
      "status": "pending",
      "parent": "task-1-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Replace single-file generation with multi-file as default. output_path becomes output_dir. Respect --single-file flag for backward compatibility.",
        "estimated_hours": 1
      }
    },
    "task-1-4-2": {
      "type": "subtask",
      "title": "Update generate_all() to handle multi-file output directory and incremental writes",
      "status": "pending",
      "parent": "task-1-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Ensure output_dir is created, all shards written incrementally (write-as-you-go), JSON still saved to single file. Track memory usage during generation.",
        "estimated_hours": 1
      }
    },
    "task-1-5": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/code_doc/cli.py",
      "status": "pending",
      "parent": "phase-1-files",
      "children": [
        "task-1-5-1",
        "task-1-5-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/code_doc/cli.py",
        "task_category": "implementation",
        "estimated_hours": 1,
        "changes_summary": "Add --single-file flag for backward compatibility, make multi-file default"
      },
      "dependencies": {
        "blocked_by": [
          "task-1-4"
        ]
      }
    },
    "task-1-5-1": {
      "type": "subtask",
      "title": "Add --single-file flag to CLI arguments",
      "status": "pending",
      "parent": "task-1-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Add optional flag: --single-file to generate legacy format. Multi-file is default. Document flag in help text.",
        "estimated_hours": 0.5
      }
    },
    "task-1-5-2": {
      "type": "subtask",
      "title": "Update help text and examples to reflect multi-file default",
      "status": "pending",
      "parent": "task-1-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Update docstring, help text, and usage examples. Document backward compatibility approach.",
        "estimated_hours": 0.5
      }
    },
    "task-1-6": {
      "type": "task",
      "title": "tests/test_formatter.py",
      "status": "pending",
      "parent": "phase-1-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "tests/test_formatter.py",
        "task_category": "implementation",
        "estimated_hours": 3,
        "changes_summary": "Add comprehensive tests for multi-file generation and BMAD index structure",
        "test_coverage": [
          "Verify all expected shards generated (index, statistics, classes, functions, dependencies, cross-references)",
          "Verify index.md contains all 7 required sections",
          "Verify index.md links are valid markdown format",
          "Verify shard content correctness",
          "Verify file structure matches spec",
          "Verify token counts per shard",
          "Verify --single-file flag produces legacy format",
          "Verify write-as-you-go pattern (memory doesn't accumulate)"
        ]
      },
      "dependencies": {
        "blocked_by": [
          "task-1-3"
        ]
      }
    },
    "task-1-7": {
      "type": "task",
      "title": "tests/test_generator.py",
      "status": "pending",
      "parent": "phase-1-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "tests/test_generator.py",
        "task_category": "implementation",
        "estimated_hours": 3,
        "changes_summary": "Update integration tests for multi-file generation and backward compatibility",
        "test_coverage": [
          "End-to-end multi-file generation",
          "JSON generation unchanged",
          "Directory structure correct",
          "Performance benchmarks (<20% regression)",
          "Backward compatibility: --single-file produces legacy format",
          "Memory usage tracking",
          "Token size comparison (multi-file vs single-file)"
        ]
      },
      "dependencies": {
        "blocked_by": [
          "task-1-4"
        ]
      }
    },
    "task-1-8": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/code_doc/SKILL.md",
      "status": "pending",
      "parent": "phase-1-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/code_doc/SKILL.md",
        "task_category": "implementation",
        "estimated_hours": 1.5,
        "changes_summary": "Document multi-file output structure, BMAD index template, backward compatibility"
      }
    },
    "phase-1-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-1",
      "children": [
        "verify-1-1",
        "verify-1-2",
        "verify-1-3"
      ],
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocked_by": [
          "phase-1-files"
        ]
      }
    },
    "verify-1-1": {
      "type": "verify",
      "title": "Multi-file generation produces all shards with correct structure",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "python -m pytest tests/test_formatter.py tests/test_generator.py -v -k multi_file",
        "expected": "All shards created: index.md (with 7 sections), statistics.md, classes.md, functions.md, dependencies.md, cross-references.md. Index links valid. Token counts appropriate."
      }
    },
    "verify-1-2": {
      "type": "verify",
      "title": "Context reduction validation on 3 sample projects",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "steps": [
          "Run multi-file generation on claude-sdd-toolkit (medium project)",
          "Run on small test project (<100 files)",
          "Run on large project (>500 files if available)",
          "For each: measure baseline single-file token count",
          "For each: measure INDEX_GUIDED load token count (index.md + typically 2-3 shards)",
          "Calculate reduction: (baseline - multi_file) / baseline * 100",
          "Verify average reduction \u226560% across all 3 projects",
          "Document results in verification notes"
        ],
        "command": "",
        "expected": ""
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-1-3": {
      "type": "verify",
      "title": "Phase 1 implementation fidelity review",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "skill": "sdd-fidelity-review",
        "scope": "phase",
        "target": "phase-1",
        "on_failure": {
          "consult": true,
          "revert_status": "in_progress",
          "continue_on_failure": false
        },
        "agent": "sdd-fidelity-review"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-2": {
      "type": "phase",
      "title": "Discovery Protocol with Error Transparency",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-2-investigation",
        "phase-2-files",
        "phase-2-verify"
      ],
      "total_tasks": 20,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Automatic content loading via INDEX_GUIDED strategy with dual format support and explicit error handling. Eliminates manual file management in workflows.",
        "risk_level": "medium",
        "estimated_duration": "3-4 days",
        "key_deliverables": [
          "doc_discovery.py module with DocumentationDiscovery class",
          "INDEX_GUIDED strategy (parse links \u2192 load files)",
          "Dual format detection (index.md first, fallback to JSON)",
          "Explicit logging (what searched, what found, what loaded)",
          "Error scenarios fully specified",
          "Proof-of-concept: sdd-plan workflow migrated"
        ]
      },
      "dependencies": {
        "blocked_by": [
          "phase-1"
        ],
        "blocks": [
          "phase-3"
        ]
      }
    },
    "phase-2-investigation": {
      "type": "group",
      "title": "Discovery Protocol Analysis",
      "status": "pending",
      "parent": "phase-2",
      "children": [
        "task-2-1",
        "task-2-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-2-files"
        ]
      }
    },
    "task-2-1": {
      "type": "task",
      "title": "Analyze BMAD discover_inputs protocol implementation",
      "status": "pending",
      "parent": "phase-2-investigation",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "research",
        "estimated_hours": 2,
        "reference_files": [
          "analysis/bmad-document-access-mechanism.md"
        ],
        "focus_areas": [
          "INDEX_GUIDED loading strategy algorithm",
          "Content variable population ({code_doc_content})",
          "Fallback mechanisms (INDEX_GUIDED \u2192 FULL_LOAD \u2192 empty)",
          "Error transparency patterns (explicit logging)"
        ],
        "deliverables": [
          "INDEX_GUIDED algorithm specification",
          "Link parsing approach (regex vs markdown library)",
          "Error scenario enumeration",
          "Logging requirements"
        ]
      },
      "dependencies": {
        "blocks": [
          "task-2-3"
        ]
      }
    },
    "task-2-2": {
      "type": "task",
      "title": "Review doc_helper.py and plan integration points",
      "status": "pending",
      "parent": "phase-2-investigation",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "investigation",
        "estimated_hours": 1,
        "focus_areas": [
          "Current helper functions for doc access",
          "How docs are currently accessed in workflows",
          "Integration with workflow system",
          "Where to add discover_code_doc() function"
        ]
      },
      "dependencies": {
        "blocks": [
          "task-2-4"
        ]
      }
    },
    "phase-2-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-2",
      "children": [
        "task-2-3",
        "task-2-4",
        "task-2-5",
        "task-2-6",
        "task-2-7"
      ],
      "total_tasks": 15,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocked_by": [
          "phase-2-investigation"
        ],
        "blocks": [
          "phase-2-verify"
        ]
      }
    },
    "task-2-3": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/common/doc_discovery.py",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [
        "task-2-3-1",
        "task-2-3-2",
        "task-2-3-3",
        "task-2-3-4",
        "task-2-3-5",
        "task-2-3-6"
      ],
      "total_tasks": 6,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/common/doc_discovery.py",
        "task_category": "implementation",
        "estimated_hours": 5,
        "changes_summary": "New module implementing BMAD-style documentation discovery protocol with error transparency"
      },
      "dependencies": {
        "blocked_by": [
          "task-2-1"
        ],
        "blocks": [
          "task-2-4",
          "task-2-6"
        ]
      }
    },
    "task-2-3-1": {
      "type": "subtask",
      "title": "Create DocumentationDiscovery class with initialization",
      "status": "pending",
      "parent": "task-2-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Class to handle discovery and loading of documentation files. Initialize with output_folder path. Track what was searched, found, and loaded for logging.",
        "estimated_hours": 0.5
      }
    },
    "task-2-3-2": {
      "type": "subtask",
      "title": "Implement _detect_format() for dual format support",
      "status": "pending",
      "parent": "task-2-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Check for index.md (multi-file format) first, then documentation.json (legacy). Return 'multi-file', 'legacy', or 'none'. Log what was checked and what was found.",
        "estimated_hours": 0.5
      }
    },
    "task-2-3-3": {
      "type": "subtask",
      "title": "Implement INDEX_GUIDED strategy (_load_index_guided method)",
      "status": "pending",
      "parent": "task-2-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Parse index.md, extract markdown links [Title](./file.md), load only referenced shard files. Concatenate with separators. Log: files searched, files found, files loaded, token counts. Handle missing linked files with warnings (partial load).",
        "estimated_hours": 2
      }
    },
    "task-2-3-4": {
      "type": "subtask",
      "title": "Implement _parse_index_links() helper using markdown library",
      "status": "pending",
      "parent": "task-2-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Use robust markdown parsing library (not regex) to extract links from index.md. Return list of (title, filepath) tuples. Handle edge cases (nested links, code blocks, etc.).",
        "estimated_hours": 1
      }
    },
    "task-2-3-5": {
      "type": "subtask",
      "title": "Implement FULL_LOAD fallback strategy (_load_full method)",
      "status": "pending",
      "parent": "task-2-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Load all .md files from docs directory, concatenate in order (index.md first if exists, then alphabetical). Used when index.md missing or malformed. Log all loaded files.",
        "estimated_hours": 0.5
      }
    },
    "task-2-3-6": {
      "type": "subtask",
      "title": "Add discover() orchestration with explicit error handling and logging",
      "status": "pending",
      "parent": "task-2-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Main entry point: (1) detect format, (2) if multi-file: try INDEX_GUIDED, (3) if legacy: load JSON and warn about deprecation, (4) if none: return empty with actionable error. Always log: what searched, what found, what loaded, strategy used, token count. Never fail silently.",
        "error_scenarios": [
          "No docs found \u2192 Warning: 'Run sdd doc generate to create documentation'",
          "index.md missing but shards exist \u2192 Warning: 'index.md not found, using FULL_LOAD fallback'",
          "Partial load (some shards missing) \u2192 Warning: 'Expected X files, found Y, missing: Z'",
          "Legacy format \u2192 Warning: 'Using legacy format. Update with sdd doc generate'",
          "Corrupted index.md \u2192 Error: 'Failed to parse index.md, falling back to FULL_LOAD'"
        ],
        "estimated_hours": 0.5
      }
    },
    "task-2-4": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/common/doc_helper.py",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [
        "task-2-4-1",
        "task-2-4-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/common/doc_helper.py",
        "task_category": "implementation",
        "estimated_hours": 2,
        "changes_summary": "Integrate discovery protocol into helper functions for workflow consumption"
      },
      "dependencies": {
        "blocked_by": [
          "task-2-2",
          "task-2-3"
        ],
        "blocks": [
          "task-2-5"
        ]
      }
    },
    "task-2-4-1": {
      "type": "subtask",
      "title": "Add get_code_doc_content() function using DocumentationDiscovery",
      "status": "pending",
      "parent": "task-2-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Function that returns loaded documentation content as string. Uses discover() from DocumentationDiscovery. Signature: get_code_doc_content(output_folder: Path, strategy: str = 'INDEX_GUIDED') -> str. Logs discovery results.",
        "estimated_hours": 1
      }
    },
    "task-2-4-2": {
      "type": "subtask",
      "title": "Add discover_code_doc() metadata function",
      "status": "pending",
      "parent": "task-2-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Returns dict with: available (bool), format ('multi-file'|'legacy'|'none'), index_path, json_path, files (list), token_count. For workflow introspection and conditional logic.",
        "estimated_hours": 1
      }
    },
    "task-2-5": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/sdd_plan/SKILL.md",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [
        "task-2-5-1",
        "task-2-5-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/sdd_plan/SKILL.md",
        "task_category": "implementation",
        "estimated_hours": 2,
        "changes_summary": "Migrate sdd-plan to use discovery protocol (proof-of-concept workflow)"
      },
      "dependencies": {
        "blocked_by": [
          "task-2-4"
        ]
      }
    },
    "task-2-5-1": {
      "type": "subtask",
      "title": "Add Step 0.5: Invoke discovery protocol in planning workflow",
      "status": "pending",
      "parent": "task-2-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Before main workflow steps, add discovery: from claude_skills.common.doc_helper import get_code_doc_content; code_doc_content = get_code_doc_content(output_folder=Path('docs'), strategy='INDEX_GUIDED'). Make content available as {code_doc_content} variable.",
        "estimated_hours": 1
      }
    },
    "task-2-5-2": {
      "type": "subtask",
      "title": "Remove manual documentation file reads, use {code_doc_content} variable",
      "status": "pending",
      "parent": "task-2-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Find and replace any direct Read calls for documentation files with usage of {code_doc_content} variable. Verify no manual file path management remains.",
        "estimated_hours": 1
      }
    },
    "task-2-6": {
      "type": "task",
      "title": "tests/test_doc_discovery.py",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [
        "task-2-6-1",
        "task-2-6-2",
        "task-2-6-3",
        "task-2-6-4"
      ],
      "total_tasks": 4,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "tests/test_doc_discovery.py",
        "task_category": "implementation",
        "estimated_hours": 4,
        "changes_summary": "Comprehensive tests for discovery protocol including all error scenarios"
      },
      "dependencies": {
        "blocked_by": [
          "task-2-3"
        ]
      }
    },
    "task-2-6-1": {
      "type": "subtask",
      "title": "Test format detection (multi-file, legacy, none)",
      "status": "pending",
      "parent": "task-2-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "test_coverage": [
          "Detects multi-file when index.md exists",
          "Detects legacy when only documentation.json exists",
          "Returns 'none' when neither exists",
          "Prefers multi-file when both exist"
        ],
        "estimated_hours": 1
      }
    },
    "task-2-6-2": {
      "type": "subtask",
      "title": "Test INDEX_GUIDED strategy",
      "status": "pending",
      "parent": "task-2-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "test_coverage": [
          "Parses index.md links correctly",
          "Loads only referenced files",
          "Concatenates files with separators",
          "Handles missing linked files gracefully (partial load warning)",
          "Logs what was searched, found, loaded"
        ],
        "estimated_hours": 1
      }
    },
    "task-2-6-3": {
      "type": "subtask",
      "title": "Test FULL_LOAD fallback",
      "status": "pending",
      "parent": "task-2-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "test_coverage": [
          "Loads all .md files when index.md missing",
          "index.md comes first if it exists",
          "Other files alphabetically ordered",
          "Concatenation is correct",
          "Logs fallback usage"
        ],
        "estimated_hours": 1
      }
    },
    "task-2-6-4": {
      "type": "subtask",
      "title": "Test all error scenarios and logging",
      "status": "pending",
      "parent": "task-2-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "test_coverage": [
          "No docs exist \u2192 Warning with actionable message",
          "Partial load \u2192 Warning listing missing files",
          "Legacy format \u2192 Deprecation warning",
          "Corrupted index.md \u2192 Error with fallback",
          "All scenarios log explicitly (never silent)",
          "Verify logging output format and content"
        ],
        "estimated_hours": 1
      }
    },
    "task-2-7": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/code_doc/SKILL.md",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/code_doc/SKILL.md",
        "task_category": "implementation",
        "estimated_hours": 1.5,
        "changes_summary": "Document discovery protocol usage, content variables, error scenarios"
      }
    },
    "phase-2-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-2",
      "children": [
        "verify-2-1",
        "verify-2-2",
        "verify-2-3"
      ],
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocked_by": [
          "phase-2-files"
        ]
      }
    },
    "verify-2-1": {
      "type": "verify",
      "title": "Discovery protocol tests pass with all error scenarios",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "python -m pytest tests/test_doc_discovery.py -v",
        "expected": "All discovery protocol tests pass including format detection, INDEX_GUIDED, FULL_LOAD, and all error scenarios"
      }
    },
    "verify-2-2": {
      "type": "verify",
      "title": "sdd-plan workflow uses discovery protocol successfully",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "steps": [
          "Generate docs for claude-sdd-toolkit using Phase 1 multi-file output",
          "Run sdd-plan on a test feature",
          "Verify {code_doc_content} is populated in workflow",
          "Verify no manual Read calls for docs in workflow execution",
          "Verify discovery logs what was searched, found, loaded",
          "Test error scenario: remove index.md, verify fallback warning",
          "Measure context size: compare to baseline single-file approach"
        ],
        "command": "",
        "expected": ""
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-2-3": {
      "type": "verify",
      "title": "Phase 2 implementation fidelity review",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "skill": "sdd-fidelity-review",
        "scope": "phase",
        "target": "phase-2",
        "on_failure": {
          "consult": true,
          "revert_status": "in_progress",
          "continue_on_failure": false
        },
        "agent": "sdd-fidelity-review"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-3": {
      "type": "phase",
      "title": "Project Type Detection & Memory Optimization",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-3-investigation",
        "phase-3-files",
        "phase-3-verify"
      ],
      "total_tasks": 15,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Add project-type awareness for optimized index.md and memory optimization for large codebases (>1000 files)",
        "risk_level": "low",
        "estimated_duration": "2-3 days",
        "key_deliverables": [
          "Project type detection for 4-5 types",
          "Type-specific index.md 'For AI-Assisted Development' sections",
          "Write-as-you-go validation on large projects",
          "Memory usage <500MB on >1000 file projects"
        ]
      },
      "dependencies": {
        "blocked_by": [
          "phase-2"
        ],
        "blocks": [
          "phase-4"
        ]
      }
    },
    "phase-3-investigation": {
      "type": "group",
      "title": "Design & Analysis",
      "status": "pending",
      "parent": "phase-3",
      "children": [
        "task-3-1",
        "task-3-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-3-files"
        ]
      }
    },
    "task-3-1": {
      "type": "task",
      "title": "Define project type detection rules for 4-5 types",
      "status": "pending",
      "parent": "phase-3-investigation",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "decision",
        "estimated_hours": 2,
        "project_types": [
          "web-frontend: React, Vue, Angular (package.json + component patterns)",
          "backend-api: FastAPI, Django, Express (requirements.txt/go.mod + API patterns)",
          "library: No app entry point, importable package (setup.py/pyproject.toml)",
          "monorepo: Multiple sub-projects (lerna.json/nx.json OR multiple package.json)",
          "cli-tool: Command-line application (bin/ directory OR click/argparse imports)"
        ],
        "focus_areas": [
          "File patterns for each type (package.json, requirements.txt, etc.)",
          "Config file detection (tsconfig.json, pyproject.toml, etc.)",
          "Priority when multiple types match (most specific wins)",
          "Simplification from BMAD's 12 types to 4-5 types"
        ],
        "deliverables": [
          "PROJECT_TYPES dict with detection patterns",
          "Type priority ordering",
          "Type-specific 'For AI-Assisted Development' guidance templates"
        ]
      },
      "dependencies": {
        "blocks": [
          "task-3-3"
        ]
      }
    },
    "task-3-2": {
      "type": "task",
      "title": "Validate write-as-you-go implementation from Phase 1",
      "status": "pending",
      "parent": "phase-3-investigation",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "investigation",
        "estimated_hours": 1,
        "focus_areas": [
          "Verify incremental file writing works in formatter.py",
          "Check memory doesn't accumulate during shard generation",
          "Identify any remaining memory accumulation points",
          "Plan memory profiling approach for >1000 file test"
        ]
      },
      "dependencies": {
        "blocks": [
          "task-3-5"
        ]
      }
    },
    "phase-3-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-3",
      "children": [
        "task-3-3",
        "task-3-4",
        "task-3-5",
        "task-3-6",
        "task-3-7"
      ],
      "total_tasks": 10,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocked_by": [
          "phase-3-investigation"
        ],
        "blocks": [
          "phase-3-verify"
        ]
      }
    },
    "task-3-3": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/code_doc/project_types.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [
        "task-3-3-1",
        "task-3-3-2",
        "task-3-3-3"
      ],
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/code_doc/project_types.py",
        "task_category": "implementation",
        "estimated_hours": 3,
        "changes_summary": "New module for simplified project type detection (4-5 types)"
      },
      "dependencies": {
        "blocked_by": [
          "task-3-1"
        ],
        "blocks": [
          "task-3-4",
          "task-3-7"
        ]
      }
    },
    "task-3-3-1": {
      "type": "subtask",
      "title": "Define PROJECT_TYPES dictionary with detection patterns",
      "status": "pending",
      "parent": "task-3-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Dict mapping type names to detection config: patterns (file globs), priority (int), ai_guidance_template (for index.md). Simpler than BMAD's CSV approach.",
        "estimated_hours": 1
      }
    },
    "task-3-3-2": {
      "type": "subtask",
      "title": "Implement detect_project_type() function",
      "status": "pending",
      "parent": "task-3-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Check project_root for patterns using glob. Return highest priority matching type or None. Handle multiple matches by priority.",
        "estimated_hours": 1.5
      }
    },
    "task-3-3-3": {
      "type": "subtask",
      "title": "Implement get_type_specific_guidance() helper",
      "status": "pending",
      "parent": "task-3-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Returns AI guidance template for 'For AI-Assisted Development' section based on project type. E.g., for web-frontend: 'For UI features \u2192 reference classes.md (components)'.",
        "estimated_hours": 0.5
      }
    },
    "task-3-4": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/code_doc/generator.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [
        "task-3-4-1",
        "task-3-4-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/code_doc/generator.py",
        "task_category": "implementation",
        "estimated_hours": 2,
        "changes_summary": "Integrate project type detection into generation workflow"
      },
      "dependencies": {
        "blocked_by": [
          "task-3-3"
        ],
        "blocks": [
          "task-3-6"
        ]
      }
    },
    "task-3-4-1": {
      "type": "subtask",
      "title": "Add project type detection in generate() method",
      "status": "pending",
      "parent": "task-3-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Call detect_project_type() early in generation, store detected type in metadata passed to formatter.",
        "estimated_hours": 1
      }
    },
    "task-3-4-2": {
      "type": "subtask",
      "title": "Pass project type to formatter for type-specific index sections",
      "status": "pending",
      "parent": "task-3-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Include project type and type-specific guidance in metadata dict passed to MarkdownGenerator for index.md generation.",
        "estimated_hours": 1
      }
    },
    "task-3-5": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/code_doc/generator.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [
        "task-3-5-1"
      ],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/code_doc/generator.py",
        "task_category": "refactoring",
        "estimated_hours": 2,
        "changes_summary": "Add optional memory profiling for large project validation"
      },
      "dependencies": {
        "blocked_by": [
          "task-3-2"
        ]
      }
    },
    "task-3-5-1": {
      "type": "subtask",
      "title": "Add optional memory profiling hooks",
      "status": "pending",
      "parent": "task-3-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Add --profile-memory flag to CLI. When enabled, track peak memory usage during generation using memory_profiler or tracemalloc. Report peak memory in output. Used for <500MB validation.",
        "estimated_hours": 2
      }
    },
    "task-3-6": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/code_doc/formatter.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [
        "task-3-6-1"
      ],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/code_doc/formatter.py",
        "task_category": "implementation",
        "estimated_hours": 2,
        "changes_summary": "Add project type-specific sections to index.md generation"
      },
      "dependencies": {
        "blocked_by": [
          "task-3-4"
        ]
      }
    },
    "task-3-6-1": {
      "type": "subtask",
      "title": "Add project type metadata and type-specific guidance to _generate_index()",
      "status": "pending",
      "parent": "task-3-6",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "In index.md Quick Reference section: include detected project type. In 'For AI-Assisted Development' section: use type-specific guidance from get_type_specific_guidance(). Maintain 3-7k token target.",
        "estimated_hours": 2
      }
    },
    "task-3-7": {
      "type": "task",
      "title": "tests/test_project_types.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [
        "task-3-7-1",
        "task-3-7-2",
        "task-3-7-3"
      ],
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "tests/test_project_types.py",
        "task_category": "implementation",
        "estimated_hours": 3,
        "changes_summary": "Comprehensive tests for project type detection"
      },
      "dependencies": {
        "blocked_by": [
          "task-3-3"
        ]
      }
    },
    "task-3-7-1": {
      "type": "subtask",
      "title": "Test detection for each of 4-5 project types",
      "status": "pending",
      "parent": "task-3-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "test_coverage": [
          "web-frontend detection (package.json + React/Vue/Angular patterns)",
          "backend-api detection (FastAPI/Django/Express patterns)",
          "library detection (setup.py/pyproject.toml, no main entry)",
          "monorepo detection (lerna.json OR multiple package.json)",
          "cli-tool detection (bin/ directory OR click/argparse imports)"
        ],
        "estimated_hours": 2
      }
    },
    "task-3-7-2": {
      "type": "subtask",
      "title": "Test priority when multiple types match",
      "status": "pending",
      "parent": "task-3-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "test_coverage": [
          "Verify highest priority type returned when multiple match",
          "Test ambiguous cases (e.g., monorepo with web-frontend sub-projects)"
        ],
        "estimated_hours": 0.5
      }
    },
    "task-3-7-3": {
      "type": "subtask",
      "title": "Test fallback when no type matches",
      "status": "pending",
      "parent": "task-3-7",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "test_coverage": [
          "Returns None when no patterns match",
          "Generic guidance used in index.md when type is None"
        ],
        "estimated_hours": 0.5
      }
    },
    "phase-3-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-3",
      "children": [
        "verify-3-1",
        "verify-3-2",
        "verify-3-3"
      ],
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocked_by": [
          "phase-3-files"
        ]
      }
    },
    "verify-3-1": {
      "type": "verify",
      "title": "Project type detection tests pass with >80% accuracy",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "python -m pytest tests/test_project_types.py -v",
        "expected": "All project type detection tests pass. Test accuracy >80% on sample projects."
      }
    },
    "verify-3-2": {
      "type": "verify",
      "title": "Memory usage validation on large project (>1000 files)",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "steps": [
          "Find or create test project with >1000 files (or use large open-source project)",
          "Run: sdd doc generate <project> --profile-memory",
          "Verify peak memory usage reported",
          "Verify peak memory <500MB",
          "Verify generation completes without errors or OOM",
          "Measure generation time vs Phase 1 baseline",
          "Verify all shards created correctly",
          "Document results and memory profile"
        ],
        "command": "",
        "expected": ""
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-3-3": {
      "type": "verify",
      "title": "Phase 3 implementation fidelity review",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "skill": "sdd-fidelity-review",
        "scope": "phase",
        "target": "phase-3",
        "on_failure": {
          "consult": true,
          "revert_status": "in_progress",
          "continue_on_failure": false
        },
        "agent": "sdd-fidelity-review"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-4": {
      "type": "phase",
      "title": "Workflow Migration & Production Readiness",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-4-investigation",
        "phase-4-files",
        "phase-4-verify"
      ],
      "total_tasks": 13,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Migrate all workflows to use discovery protocol and validate production readiness. Achieve 100% content variable usage (zero manual file reads).",
        "risk_level": "medium-high",
        "estimated_duration": "3-4 days",
        "key_deliverables": [
          "All workflows migrated to discovery protocol pattern",
          "100% workflows using {code_doc_content} (zero manual Read calls)",
          "All SKILL.md documentation updated",
          "Success metrics validated",
          "Migration guide and troubleshooting documentation"
        ]
      },
      "dependencies": {
        "blocked_by": [
          "phase-3"
        ]
      }
    },
    "phase-4-investigation": {
      "type": "group",
      "title": "Workflow Discovery",
      "status": "pending",
      "parent": "phase-4",
      "children": [
        "task-4-1"
      ],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-4-files"
        ]
      }
    },
    "task-4-1": {
      "type": "task",
      "title": "Identify all workflows that reference code-doc or documentation",
      "status": "pending",
      "parent": "phase-4-investigation",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "investigation",
        "estimated_hours": 2,
        "focus_areas": [
          "Grep for 'code-doc', 'documentation.json', 'DOCUMENTATION.md' references",
          "Find workflows with manual Read calls to docs/",
          "Identify doc_helper.py usage patterns",
          "Create prioritized migration list"
        ],
        "deliverables": [
          "Complete list of workflows to migrate",
          "Priority order (critical workflows first)",
          "Estimated effort per workflow"
        ]
      },
      "dependencies": {
        "blocks": [
          "task-4-2",
          "task-4-3",
          "task-4-4"
        ]
      }
    },
    "phase-4-files": {
      "type": "group",
      "title": "Workflow Migrations",
      "status": "pending",
      "parent": "phase-4",
      "children": [
        "task-4-2",
        "task-4-3",
        "task-4-4",
        "task-4-5"
      ],
      "total_tasks": 8,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocked_by": [
          "phase-4-investigation"
        ],
        "blocks": [
          "phase-4-verify"
        ]
      }
    },
    "task-4-2": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/sdd_next/SKILL.md",
      "status": "pending",
      "parent": "phase-4-files",
      "children": [
        "task-4-2-1",
        "task-4-2-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/sdd_next/SKILL.md",
        "task_category": "implementation",
        "estimated_hours": 2,
        "changes_summary": "Migrate sdd-next to use discovery protocol"
      },
      "dependencies": {
        "blocked_by": [
          "task-4-1"
        ]
      }
    },
    "task-4-2-1": {
      "type": "subtask",
      "title": "Add Step 0.5: Discovery protocol integration",
      "status": "pending",
      "parent": "task-4-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Add discovery step before main workflow: get_code_doc_content() when available, populate {code_doc_content} variable.",
        "estimated_hours": 1
      }
    },
    "task-4-2-2": {
      "type": "subtask",
      "title": "Remove manual documentation file reads",
      "status": "pending",
      "parent": "task-4-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Replace direct Read calls with content variable usage. Verify zero manual file path management.",
        "estimated_hours": 1
      }
    },
    "task-4-3": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/sdd_fidelity_review/SKILL.md",
      "status": "pending",
      "parent": "phase-4-files",
      "children": [
        "task-4-3-1",
        "task-4-3-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/sdd_fidelity_review/SKILL.md",
        "task_category": "implementation",
        "estimated_hours": 2,
        "changes_summary": "Migrate sdd-fidelity-review to use discovery protocol"
      },
      "dependencies": {
        "blocked_by": [
          "task-4-1"
        ]
      }
    },
    "task-4-3-1": {
      "type": "subtask",
      "title": "Add Step 0.5: Discovery protocol integration",
      "status": "pending",
      "parent": "task-4-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Use get_code_doc_content() for codebase context during fidelity review.",
        "estimated_hours": 1
      }
    },
    "task-4-3-2": {
      "type": "subtask",
      "title": "Remove manual documentation file reads",
      "status": "pending",
      "parent": "task-4-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Replace direct Read calls with content variable usage.",
        "estimated_hours": 1
      }
    },
    "task-4-4": {
      "type": "task",
      "title": "Migrate remaining workflows identified in investigation",
      "status": "pending",
      "parent": "phase-4-files",
      "children": [
        "task-4-4-1"
      ],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "implementation",
        "estimated_hours": 3,
        "changes_summary": "Apply discovery protocol pattern to all remaining workflows",
        "file_path": "task-4-4.md"
      },
      "dependencies": {
        "blocked_by": [
          "task-4-1"
        ]
      }
    },
    "task-4-4-1": {
      "type": "subtask",
      "title": "Update each identified workflow with discovery protocol pattern",
      "status": "pending",
      "parent": "task-4-4",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "For each workflow from investigation: add Step 0.5 discovery, use {code_doc_content}, remove manual reads. Test each workflow after migration.",
        "estimated_hours": 3
      }
    },
    "task-4-5": {
      "type": "task",
      "title": "Update all SKILL.md documentation files",
      "status": "pending",
      "parent": "phase-4-files",
      "children": [
        "task-4-5-1",
        "task-4-5-2",
        "task-4-5-3"
      ],
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "implementation",
        "estimated_hours": 2,
        "changes_summary": "Document multi-file structure, discovery protocol, migration patterns across all relevant SKILL.md files",
        "file_path": "task-4-5.md"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-5-1": {
      "type": "subtask",
      "title": "Update code-doc SKILL.md with complete multi-file documentation",
      "status": "pending",
      "parent": "task-4-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Document: new multi-file structure, BMAD 7-section index.md format, discovery protocol usage, backward compatibility (--single-file flag), project type detection, error scenarios.",
        "estimated_hours": 1
      }
    },
    "task-4-5-2": {
      "type": "subtask",
      "title": "Update doc-query SKILL.md to reference multi-file structure",
      "status": "pending",
      "parent": "task-4-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Explain how doc-query works with new structure. JSON remains primary source for queries, but document multi-file Markdown context.",
        "estimated_hours": 0.5
      }
    },
    "task-4-5-3": {
      "type": "subtask",
      "title": "Create migration guide and troubleshooting documentation",
      "status": "pending",
      "parent": "task-4-5",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": "Document: migration pattern for workflows, common issues and solutions, error message meanings, rollback procedure, deprecation timeline.",
        "estimated_hours": 0.5
      }
    },
    "phase-4-verify": {
      "type": "group",
      "title": "Final Verification",
      "status": "pending",
      "parent": "phase-4",
      "children": [
        "verify-4-1",
        "verify-4-2",
        "verify-4-3",
        "verify-4-4"
      ],
      "total_tasks": 4,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocked_by": [
          "phase-4-files"
        ]
      }
    },
    "verify-4-1": {
      "type": "verify",
      "title": "All tests pass end-to-end with no regressions",
      "status": "pending",
      "parent": "phase-4-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "python -m pytest tests/ -v --cov",
        "expected": "All tests pass, >80% coverage, <20% performance regression vs baseline"
      }
    },
    "verify-4-2": {
      "type": "verify",
      "title": "Validate all success metrics achieved",
      "status": "pending",
      "parent": "phase-4-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "metrics_checklist": [
          "\u2705 Context reduction \u226560% on 3 sample projects (measured in verify-1-2)",
          "\u2705 Performance impact <20% on benchmark suite (measured in verify-4-1)",
          "\u2705 100% workflows using {code_doc_content} variables (grep verification: zero manual Read calls to docs/)",
          "\u2705 Successfully processes project >1000 files (measured in verify-3-2)",
          "\u2705 Memory peak <500MB on large project (measured in verify-3-2)",
          "\u2705 Project type detection accurate >80% (measured in verify-3-1)"
        ],
        "command": "",
        "expected": ""
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-4-3": {
      "type": "verify",
      "title": "Documentation completeness and accuracy",
      "status": "pending",
      "parent": "phase-4-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "checklist": [
          "All SKILL.md files updated with multi-file structure",
          "Examples accurate and working",
          "Migration patterns documented",
          "Troubleshooting guide complete",
          "Error scenarios documented with actionable messages",
          "BMAD template references included",
          "Backward compatibility clearly explained"
        ],
        "command": "",
        "expected": ""
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-4-4": {
      "type": "verify",
      "title": "Full spec implementation fidelity review",
      "status": "pending",
      "parent": "phase-4-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "skill": "sdd-fidelity-review",
        "scope": "full",
        "target": "spec-root",
        "on_failure": {
          "consult": true,
          "revert_status": "in_progress",
          "continue_on_failure": false
        },
        "agent": "sdd-fidelity-review"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    }
  }
}