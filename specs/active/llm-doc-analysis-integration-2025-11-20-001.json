{
  "spec_id": "llm-doc-analysis-integration-2025-11-20-001",
  "title": "Integrate Codebase Analysis into LLM Documentation Generation",
  "generated": "2025-11-20T12:00:00Z",
  "last_updated": "2025-11-20T23:54:09.268869Z",
  "metadata": {
    "description": "Integrate codebase.json analysis data into AI consultant prompts for llm-doc-gen to improve documentation quality through structural insights, complexity metrics, and cross-reference information.",
    "objectives": [
      "Provide AI consultants with curated analysis insights from codebase.json",
      "Improve documentation accuracy by grounding AI in actual code structure",
      "Reduce token usage through compact formatting and adaptive budgets",
      "Leverage existing doc_query infrastructure for codebase analysis",
      "Enable query-based deep dives into analysis data"
    ],
    "complexity": "high",
    "estimated_hours": 40,
    "assumptions": [
      "codebase.json is generated by code-docers integration in llm-doc-gen",
      "Existing doc_query infrastructure can be extended to support codebase.json",
      "AI models benefit from structured analysis data in prompts",
      "Token budgets of 250-450 tokens per generator are acceptable overhead"
    ],
    "revision_history": [],
    "progress_percentage": 6,
    "status": "active",
    "current_phase": "phase-1"
  },
  "hierarchy": {
    "spec-root": {
      "type": "spec",
      "title": "Integrate Codebase Analysis into LLM Documentation Generation",
      "status": "in_progress",
      "parent": null,
      "children": [
        "phase-1",
        "phase-2",
        "phase-3",
        "phase-4",
        "phase-5",
        "phase-6"
      ],
      "total_tasks": 46,
      "completed_tasks": 3,
      "metadata": {}
    },
    "phase-1": {
      "type": "phase",
      "title": "Investigation & Design",
      "status": "in_progress",
      "parent": "spec-root",
      "children": [
        "phase-1-investigation",
        "phase-1-verify"
      ],
      "total_tasks": 6,
      "completed_tasks": 3,
      "metadata": {
        "purpose": "Understand existing infrastructure and design integration approach based on multi-model consensus feedback",
        "risk_level": "low"
      },
      "dependencies": {
        "blocks": [
          "phase-2"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-1-investigation": {
      "type": "group",
      "title": "Investigation Tasks",
      "status": "in_progress",
      "parent": "phase-1",
      "children": [
        "task-1-1",
        "task-1-2",
        "task-1-3",
        "task-1-4"
      ],
      "total_tasks": 4,
      "completed_tasks": 3,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-1-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-1": {
      "type": "task",
      "title": "Analyze codebase.json vs documentation.json relationship",
      "status": "completed",
      "parent": "phase-1-investigation",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-2-1",
          "task-1-4"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "task_category": "investigation",
        "estimated_hours": 2,
        "details": [
          "Examine structure of codebase.json generated by llm-doc-gen",
          "Examine structure of documentation.json used by doc_query",
          "Determine if they are the same format or need translation layer",
          "Document schema differences if any"
        ],
        "started_at": "2025-11-20T23:50:36.498676Z",
        "status_note": "Beginning investigation of codebase.json vs documentation.json formats",
        "completed_at": "2025-11-20T23:51:40.970216Z",
        "needs_journaling": false,
        "actual_hours": 0.018,
        "journaled_at": "2025-11-20T23:51:40.974001Z"
      }
    },
    "task-1-2": {
      "type": "task",
      "title": "Review existing doc_query capabilities",
      "status": "completed",
      "parent": "phase-1-investigation",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-5-1",
          "task-1-4"
        ],
        "blocked_by": [],
        "depends": [
          "task-1-1"
        ]
      },
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "task_category": "investigation",
        "estimated_hours": 2,
        "details": [
          "Review doc_query_lib.py query methods",
          "Examine existing workflows: impact_analysis, refactor_candidates, trace_data, trace_entry",
          "Identify which capabilities can be reused for llm-doc-gen",
          "Note any gaps that need to be filled"
        ],
        "started_at": "2025-11-20T23:52:04.719025Z",
        "status_note": "Beginning review of doc_query capabilities and workflows",
        "completed_at": "2025-11-20T23:53:00.427735Z",
        "needs_journaling": false,
        "actual_hours": 0.015,
        "journaled_at": "2025-11-20T23:53:00.431969Z"
      }
    },
    "task-1-3": {
      "type": "task",
      "title": "Define metrics to extract based on consensus feedback",
      "status": "completed",
      "parent": "phase-1-investigation",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-2-2",
          "task-1-4"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "task_category": "decision",
        "estimated_hours": 1,
        "details": [
          "Priority 1 metrics: Most called functions, high complexity, entry points, cross-module deps",
          "Priority 2 metrics: Instantiated classes, module complexity ranking",
          "New metrics from consensus: Fan-out analysis, dependency clusters",
          "Per-generator focus areas (architecture vs component vs overview)"
        ],
        "started_at": "2025-11-20T23:53:28.553627Z",
        "status_note": "Defining priority metrics for analysis insights",
        "completed_at": "2025-11-20T23:54:09.263823Z",
        "needs_journaling": false,
        "actual_hours": 0.011,
        "journaled_at": "2025-11-20T23:54:09.267414Z"
      }
    },
    "task-1-4": {
      "type": "task",
      "title": "Design analysis_insights.py module architecture",
      "status": "pending",
      "parent": "phase-1-investigation",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-2-1",
          "task-2-2"
        ],
        "blocked_by": [
          "task-1-1",
          "task-1-2",
          "task-1-3"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "decision",
        "estimated_hours": 2,
        "details": [
          "Define AnalysisInsights dataclass structure",
          "Design extract_insights_from_analysis() function signature",
          "Design format_insights_for_prompt() per-generator approach",
          "Plan caching strategy for 5.5MB JSON parsing",
          "Plan adaptive token budget strategy (250-450 tokens)"
        ],
        "file_path": "task-1-4.md"
      }
    },
    "phase-1-verify": {
      "type": "group",
      "title": "Phase 1 Verification",
      "status": "pending",
      "parent": "phase-1",
      "children": [
        "verify-1-1",
        "verify-1-2"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-1-investigation"
        ],
        "blocks": [],
        "depends": []
      },
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-1-1": {
      "type": "verify",
      "title": "Design document review",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "expected": "Design addresses multi-model consensus feedback and leverages existing doc_query infrastructure",
        "command": ""
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-1-2": {
      "type": "verify",
      "title": "Phase 1 fidelity review",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "agent": "sdd-fidelity-review",
        "scope": "phase",
        "target": "phase-1"
      }
    },
    "phase-2": {
      "type": "phase",
      "title": "Core Infrastructure - analysis_insights.py",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-2-files",
        "phase-2-verify"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-1"
        ],
        "blocks": [
          "phase-3",
          "task-3-1"
        ],
        "depends": []
      },
      "total_tasks": 10,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Create analysis_insights.py module with extraction, formatting, and caching capabilities",
        "risk_level": "medium"
      }
    },
    "phase-2-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-2",
      "children": [
        "task-2-1",
        "task-2-2",
        "task-2-3",
        "task-2-4",
        "task-2-5"
      ],
      "total_tasks": 7,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-2-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-1": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/llm_doc_gen/analysis_insights.py",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [
        "task-2-1-1",
        "task-2-1-2",
        "task-2-1-3"
      ],
      "dependencies": {
        "blocked_by": [
          "task-1-1",
          "task-1-4"
        ],
        "blocks": [
          "task-2-3"
        ],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/llm_doc_gen/analysis_insights.py",
        "task_category": "implementation",
        "estimated_hours": 4,
        "changes": "Create new module for extracting and formatting analysis insights"
      }
    },
    "task-2-1-1": {
      "type": "subtask",
      "title": "Create AnalysisInsights dataclass",
      "status": "pending",
      "parent": "task-2-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": [
          "Define AnalysisInsights dataclass with fields:",
          "- high_complexity_functions: List[str]",
          "- most_called_functions: List[Dict]",
          "- most_instantiated_classes: List[Dict]",
          "- entry_points: List[Dict] (NEW from consensus)",
          "- integration_points: List[Dict]",
          "- cross_module_dependencies: List[Dict] (NEW from consensus)",
          "- fan_out_analysis: List[Dict] (NEW from consensus)",
          "- language_breakdown: Dict[str, Dict]",
          "- module_statistics: Dict[str, int]"
        ]
      }
    },
    "task-2-1-2": {
      "type": "subtask",
      "title": "Implement extract_insights_from_analysis()",
      "status": "pending",
      "parent": "task-2-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": [
          "Extract Priority 1 metrics: most called, high complexity, entry points, cross-module deps",
          "Extract Priority 2 metrics: instantiated classes, module complexity",
          "Calculate entry points (functions with 0-2 callers)",
          "Identify fan-out patterns (functions calling 8+ others)",
          "Build cross-module dependency map",
          "Implement caching mechanism for loaded JSON",
          "Add adaptive scaling based on codebase size (<100 files, 100-500, >500)"
        ]
      }
    },
    "task-2-1-3": {
      "type": "subtask",
      "title": "Implement format_insights_for_prompt()",
      "status": "pending",
      "parent": "task-2-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": [
          "Implement generator-specific formatting (architecture, component, overview)",
          "Use table format instead of prose (30% token savings per consensus)",
          "Adaptive token budgets: Architecture 450, Component 350, Overview 250",
          "Priority-based truncation when over budget",
          "Add file path reference with framing: 'available for reference'",
          "Include example queries in file path reference"
        ]
      }
    },
    "task-2-2": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/llm_doc_gen/analysis_cache.py",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [
        "task-2-2-1"
      ],
      "dependencies": {
        "blocked_by": [
          "task-1-3",
          "task-1-4"
        ],
        "blocks": [
          "task-2-4"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/llm_doc_gen/analysis_cache.py",
        "task_category": "implementation",
        "estimated_hours": 2,
        "changes": "Create caching layer for codebase.json to avoid re-parsing 5.5MB file"
      }
    },
    "task-2-2-1": {
      "type": "subtask",
      "title": "Implement JSON caching with freshness tracking",
      "status": "pending",
      "parent": "task-2-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": [
          "In-memory cache for loaded JSON (singleton pattern)",
          "File modification time tracking for cache invalidation",
          "Freshness warning if codebase.json >24 hours old",
          "Cache hit/miss metrics for performance monitoring",
          "Two-phase extraction: load once, cache results, format per generator"
        ]
      }
    },
    "task-2-3": {
      "type": "task",
      "title": "tests/llm_doc_gen/test_analysis_insights.py",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [
        "task-2-3-1"
      ],
      "dependencies": {
        "blocked_by": [
          "task-2-1"
        ],
        "blocks": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "tests/llm_doc_gen/test_analysis_insights.py",
        "task_category": "implementation",
        "estimated_hours": 3,
        "changes": "Create comprehensive tests for analysis insights extraction and formatting"
      }
    },
    "task-2-3-1": {
      "type": "subtask",
      "title": "Create test suite for analysis_insights",
      "status": "pending",
      "parent": "task-2-3",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": [
          "Test extract_insights_from_analysis() with sample codebase.json",
          "Test format_insights_for_prompt() for each generator type",
          "Test token budget enforcement (250, 350, 450 limits)",
          "Test priority-based truncation",
          "Test adaptive scaling by codebase size",
          "Test table formatting vs prose (verify token savings)",
          "Test caching mechanism"
        ]
      }
    },
    "task-2-4": {
      "type": "task",
      "title": "tests/llm_doc_gen/test_analysis_cache.py",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [],
      "dependencies": {
        "blocked_by": [
          "task-2-2"
        ],
        "blocks": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "tests/llm_doc_gen/test_analysis_cache.py",
        "task_category": "implementation",
        "estimated_hours": 1,
        "changes": "Test caching layer functionality"
      }
    },
    "task-2-5": {
      "type": "task",
      "title": "tests/llm_doc_gen/fixtures/sample_codebase.json",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [],
      "dependencies": {
        "blocked_by": [],
        "blocks": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "tests/llm_doc_gen/fixtures/sample_codebase.json",
        "task_category": "implementation",
        "estimated_hours": 1,
        "changes": "Create sample codebase.json for testing"
      }
    },
    "phase-2-verify": {
      "type": "group",
      "title": "Phase 2 Verification",
      "status": "pending",
      "parent": "phase-2",
      "children": [
        "verify-2-1",
        "verify-2-2",
        "verify-2-3"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-2-files"
        ],
        "blocks": [],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-2-1": {
      "type": "verify",
      "title": "Run test suite",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/llm_doc_gen/test_analysis_insights.py tests/llm_doc_gen/test_analysis_cache.py -v",
        "expected": "All tests pass"
      }
    },
    "verify-2-2": {
      "type": "verify",
      "title": "Verify token budgets",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "expected": "Generated insights stay within Architecture:450, Component:350, Overview:250 token limits",
        "command": ""
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-2-3": {
      "type": "verify",
      "title": "Phase 2 fidelity review",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "agent": "sdd-fidelity-review",
        "scope": "phase",
        "target": "phase-2"
      }
    },
    "phase-3": {
      "type": "phase",
      "title": "Architecture Generator Integration",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-3-files",
        "phase-3-verify"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-2"
        ],
        "blocks": [
          "phase-4",
          "task-4-1",
          "task-4-2"
        ],
        "depends": []
      },
      "total_tasks": 8,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Integrate analysis insights into architecture generator (highest value per consensus)",
        "risk_level": "medium"
      }
    },
    "phase-3-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-3",
      "children": [
        "task-3-1",
        "task-3-2",
        "task-3-3"
      ],
      "total_tasks": 4,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-3-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-1": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/llm_doc_gen/generators/architecture_generator.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [
        "task-3-1-1",
        "task-3-1-2"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-2"
        ],
        "blocks": [
          "task-3-2",
          "task-3-3"
        ],
        "depends": []
      },
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/llm_doc_gen/generators/architecture_generator.py",
        "task_category": "implementation",
        "estimated_hours": 3,
        "changes": "Add analysis insights section to architecture prompt"
      }
    },
    "task-3-1-1": {
      "type": "subtask",
      "title": "Update format_architecture_prompt() signature",
      "status": "pending",
      "parent": "task-3-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": [
          "Add optional analysis_data parameter",
          "Import extract_insights_from_analysis, format_insights_for_prompt from analysis_insights",
          "Extract insights with focus='architecture'",
          "Format with generator_type='architecture', max_tokens=450"
        ]
      }
    },
    "task-3-1-2": {
      "type": "subtask",
      "title": "Insert analysis insights section into prompt",
      "status": "pending",
      "parent": "task-3-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": [
          "Insert after tech stack, before key files section",
          "Include integration points, entry points, complexity hotspots, cross-module deps",
          "Add file path reference with framing: 'Available for reference (not guaranteed AI-readable)'",
          "Include example queries: 'What are the 5 most complex functions in module X?'",
          "Add note: 'Use these insights to inform your analysis, but verify against actual source code'"
        ]
      }
    },
    "task-3-2": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/llm_doc_gen/main.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [],
      "dependencies": {
        "blocked_by": [
          "task-3-1"
        ],
        "blocks": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/llm_doc_gen/main.py",
        "task_category": "implementation",
        "estimated_hours": 1,
        "changes": "Pass analysis_data to architecture generator"
      }
    },
    "task-3-3": {
      "type": "task",
      "title": "tests/llm_doc_gen/test_architecture_generator.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [],
      "dependencies": {
        "blocked_by": [
          "task-3-1"
        ],
        "blocks": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "tests/llm_doc_gen/test_architecture_generator.py",
        "task_category": "implementation",
        "estimated_hours": 2,
        "changes": "Test architecture generator with analysis insights"
      }
    },
    "phase-3-verify": {
      "type": "group",
      "title": "Phase 3 Verification",
      "status": "pending",
      "parent": "phase-3",
      "children": [
        "verify-3-1",
        "verify-3-2",
        "verify-3-3",
        "verify-3-4"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-3-files"
        ],
        "blocks": [],
        "depends": []
      },
      "total_tasks": 4,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-3-1": {
      "type": "verify",
      "title": "Run architecture generator tests",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/llm_doc_gen/test_architecture_generator.py -v",
        "expected": "All tests pass"
      }
    },
    "verify-3-2": {
      "type": "verify",
      "title": "Generate architecture docs with this codebase",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "command": "sdd llm-doc-gen generate ./src --output-dir ./test-docs --name test-run",
        "expected": "Architecture docs generated successfully with insights included in prompt"
      }
    },
    "verify-3-3": {
      "type": "verify",
      "title": "Compare before/after documentation quality",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "expected": "New docs identify architectural patterns more accurately (e.g., provider abstraction layer)",
        "command": ""
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-3-4": {
      "type": "verify",
      "title": "Phase 3 fidelity review",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "agent": "sdd-fidelity-review",
        "scope": "phase",
        "target": "phase-3"
      }
    },
    "phase-4": {
      "type": "phase",
      "title": "Component & Overview Generator Integration",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-4-files",
        "phase-4-verify"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-3"
        ],
        "blocks": [
          "phase-5"
        ],
        "depends": []
      },
      "total_tasks": 7,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Extend analysis insights to component and overview generators",
        "risk_level": "low"
      }
    },
    "phase-4-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-4",
      "children": [
        "task-4-1",
        "task-4-2",
        "task-4-3",
        "task-4-4"
      ],
      "total_tasks": 4,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-4-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-4-1": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/llm_doc_gen/generators/component_generator.py",
      "status": "pending",
      "parent": "phase-4-files",
      "children": [
        "task-4-1-1"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-3"
        ],
        "blocks": [
          "task-4-3"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/llm_doc_gen/generators/component_generator.py",
        "task_category": "implementation",
        "estimated_hours": 2,
        "changes": "Add analysis insights to component generator (350 token budget)"
      }
    },
    "task-4-1-1": {
      "type": "subtask",
      "title": "Integrate component-focused insights",
      "status": "pending",
      "parent": "task-4-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": [
          "Focus on: instantiation patterns, module boundaries, component dependencies",
          "Token budget: 350",
          "Optional file path reference (configurable)"
        ]
      }
    },
    "task-4-2": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/llm_doc_gen/generators/overview_generator.py",
      "status": "pending",
      "parent": "phase-4-files",
      "children": [
        "task-4-2-1"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-3"
        ],
        "blocks": [
          "task-4-4"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/llm_doc_gen/generators/overview_generator.py",
        "task_category": "implementation",
        "estimated_hours": 2,
        "changes": "Enhance existing analysis section (currently lines 125-160) with additional insights"
      }
    },
    "task-4-2-1": {
      "type": "subtask",
      "title": "Expand existing statistics section",
      "status": "pending",
      "parent": "task-4-2",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": [
          "Keep existing module and language stats (lines 125-160)",
          "Add: Most referenced functions (top 8)",
          "Add: Core classes by instantiation (top 8)",
          "Add: Entry points hint",
          "Token budget: 250 (overview already has stats)"
        ]
      }
    },
    "task-4-3": {
      "type": "task",
      "title": "tests/llm_doc_gen/test_component_generator.py",
      "status": "pending",
      "parent": "phase-4-files",
      "children": [],
      "dependencies": {
        "blocked_by": [
          "task-4-1"
        ],
        "blocks": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "tests/llm_doc_gen/test_component_generator.py",
        "task_category": "implementation",
        "estimated_hours": 1,
        "changes": "Test component generator with insights"
      }
    },
    "task-4-4": {
      "type": "task",
      "title": "tests/llm_doc_gen/test_overview_generator.py",
      "status": "pending",
      "parent": "phase-4-files",
      "children": [],
      "dependencies": {
        "blocked_by": [
          "task-4-2"
        ],
        "blocks": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "tests/llm_doc_gen/test_overview_generator.py",
        "task_category": "implementation",
        "estimated_hours": 1,
        "changes": "Test overview generator enhancements"
      }
    },
    "phase-4-verify": {
      "type": "group",
      "title": "Phase 4 Verification",
      "status": "pending",
      "parent": "phase-4",
      "children": [
        "verify-4-1",
        "verify-4-2",
        "verify-4-3"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-4-files"
        ],
        "blocks": [],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-4-1": {
      "type": "verify",
      "title": "Run all generator tests",
      "status": "pending",
      "parent": "phase-4-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/llm_doc_gen/test_component_generator.py tests/llm_doc_gen/test_overview_generator.py -v",
        "expected": "All tests pass"
      }
    },
    "verify-4-2": {
      "type": "verify",
      "title": "Full documentation generation test",
      "status": "pending",
      "parent": "phase-4-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "command": "sdd llm-doc-gen generate ./src --output-dir ./test-docs --name full-test",
        "expected": "All doc types (architecture, component, overview) generated with insights"
      }
    },
    "verify-4-3": {
      "type": "verify",
      "title": "Phase 4 fidelity review",
      "status": "pending",
      "parent": "phase-4-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "agent": "sdd-fidelity-review",
        "scope": "phase",
        "target": "phase-4"
      }
    },
    "phase-5": {
      "type": "phase",
      "title": "Query Tool Integration & Advanced Features",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-5-files",
        "phase-5-verify"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-4"
        ],
        "blocks": [
          "phase-6"
        ],
        "depends": []
      },
      "total_tasks": 7,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Extend doc_query to support codebase.json querying and add advanced features from consensus",
        "risk_level": "medium"
      }
    },
    "phase-5-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-5",
      "children": [
        "task-5-1",
        "task-5-2",
        "task-5-3",
        "task-5-4"
      ],
      "total_tasks": 4,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-5-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-5-1": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/doc_query/codebase_query.py",
      "status": "pending",
      "parent": "phase-5-files",
      "children": [
        "task-5-1-1"
      ],
      "dependencies": {
        "blocked_by": [
          "task-1-2"
        ],
        "blocks": [
          "task-5-3"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/doc_query/codebase_query.py",
        "task_category": "implementation",
        "estimated_hours": 4,
        "changes": "Extend DocumentationQuery to support codebase.json format"
      }
    },
    "task-5-1-1": {
      "type": "subtask",
      "title": "Create CodebaseQuery class",
      "status": "pending",
      "parent": "task-5-1",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "details": [
          "Extend or adapt DocumentationQuery for codebase.json",
          "Support queries: 'What are N most complex functions in module X?'",
          "Support queries: 'Which functions call function Y?'",
          "Support queries: 'What classes are instantiated in file Z?'",
          "Auto-detect codebase.json in docs/ directory",
          "Return formatted responses suitable for LLM prompts"
        ]
      }
    },
    "task-5-2": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/llm_doc_gen/freshness.py",
      "status": "pending",
      "parent": "phase-5-files",
      "children": [],
      "dependencies": {
        "blocked_by": [],
        "blocks": [
          "task-5-4"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/llm_doc_gen/freshness.py",
        "task_category": "implementation",
        "estimated_hours": 1,
        "changes": "Add freshness checking for codebase.json"
      }
    },
    "task-5-3": {
      "type": "task",
      "title": "tests/doc_query/test_codebase_query.py",
      "status": "pending",
      "parent": "phase-5-files",
      "children": [],
      "dependencies": {
        "blocked_by": [
          "task-5-1"
        ],
        "blocks": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "tests/doc_query/test_codebase_query.py",
        "task_category": "implementation",
        "estimated_hours": 2,
        "changes": "Test codebase query functionality"
      }
    },
    "task-5-4": {
      "type": "task",
      "title": "tests/llm_doc_gen/test_freshness.py",
      "status": "pending",
      "parent": "phase-5-files",
      "children": [],
      "dependencies": {
        "blocked_by": [
          "task-5-2"
        ],
        "blocks": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "tests/llm_doc_gen/test_freshness.py",
        "task_category": "implementation",
        "estimated_hours": 1,
        "changes": "Test freshness checking"
      }
    },
    "phase-5-verify": {
      "type": "group",
      "title": "Phase 5 Verification",
      "status": "pending",
      "parent": "phase-5",
      "children": [
        "verify-5-1",
        "verify-5-2",
        "verify-5-3"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-5-files"
        ],
        "blocks": [],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-5-1": {
      "type": "verify",
      "title": "Run query tool tests",
      "status": "pending",
      "parent": "phase-5-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/doc_query/test_codebase_query.py tests/llm_doc_gen/test_freshness.py -v",
        "expected": "All tests pass"
      }
    },
    "verify-5-2": {
      "type": "verify",
      "title": "Test query tool with codebase.json",
      "status": "pending",
      "parent": "phase-5-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "expected": "Can successfully query codebase.json for complex functions, callers, instantiated classes",
        "command": ""
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-5-3": {
      "type": "verify",
      "title": "Phase 5 fidelity review",
      "status": "pending",
      "parent": "phase-5-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "agent": "sdd-fidelity-review",
        "scope": "phase",
        "target": "phase-5"
      }
    },
    "phase-6": {
      "type": "phase",
      "title": "Testing, Documentation & Best Practices",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-6-files",
        "phase-6-verify"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-5"
        ],
        "blocks": [],
        "depends": []
      },
      "total_tasks": 8,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "A/B testing, documentation, and best practices guide",
        "risk_level": "low"
      }
    },
    "phase-6-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-6",
      "children": [
        "task-6-1",
        "task-6-2",
        "task-6-3",
        "task-6-4",
        "task-6-5"
      ],
      "total_tasks": 5,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-6-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-1": {
      "type": "task",
      "title": "Create A/B testing framework",
      "status": "pending",
      "parent": "phase-6-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "implementation",
        "estimated_hours": 3,
        "details": [
          "Generate docs with and without analysis insights",
          "Create evaluation rubric for documentation quality",
          "Measure: accuracy of architectural patterns identified, completeness, relevance",
          "Document results"
        ],
        "file_path": "task-6-1.md"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-2": {
      "type": "task",
      "title": "Performance benchmarking",
      "status": "pending",
      "parent": "phase-6-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "task_category": "implementation",
        "estimated_hours": 2,
        "details": [
          "Measure caching impact on performance",
          "Verify <2s overhead for insight extraction",
          "Test with small, medium, large codebases",
          "Document performance characteristics"
        ],
        "file_path": "task-6-2.md"
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-6-3": {
      "type": "task",
      "title": "docs/llm-doc-gen/ANALYSIS_INTEGRATION.md",
      "status": "pending",
      "parent": "phase-6-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "docs/llm-doc-gen/ANALYSIS_INTEGRATION.md",
        "task_category": "implementation",
        "estimated_hours": 2,
        "changes": "Document how analysis integration works"
      }
    },
    "task-6-4": {
      "type": "task",
      "title": "docs/llm-doc-gen/BEST_PRACTICES.md",
      "status": "pending",
      "parent": "phase-6-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "docs/llm-doc-gen/BEST_PRACTICES.md",
        "task_category": "implementation",
        "estimated_hours": 2,
        "changes": "Document best practices for using analysis insights"
      }
    },
    "task-6-5": {
      "type": "task",
      "title": "Update skills/llm-doc-gen/SKILL.md",
      "status": "pending",
      "parent": "phase-6-files",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "skills/llm-doc-gen/SKILL.md",
        "task_category": "implementation",
        "estimated_hours": 1,
        "changes": "Update skill documentation to mention analysis integration"
      }
    },
    "phase-6-verify": {
      "type": "group",
      "title": "Phase 6 Verification",
      "status": "pending",
      "parent": "phase-6",
      "children": [
        "verify-6-1",
        "verify-6-2",
        "verify-6-3"
      ],
      "dependencies": {
        "blocked_by": [
          "phase-6-files"
        ],
        "blocks": [],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-6-1": {
      "type": "verify",
      "title": "Review A/B test results",
      "status": "pending",
      "parent": "phase-6-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "expected": "Documentation with insights shows measurable improvement in identifying architectural patterns",
        "command": ""
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-6-2": {
      "type": "verify",
      "title": "Documentation review",
      "status": "pending",
      "parent": "phase-6-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "expected": "All documentation is clear, complete, and accurate",
        "command": ""
      },
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      }
    },
    "verify-6-3": {
      "type": "verify",
      "title": "Phase 6 fidelity review",
      "status": "pending",
      "parent": "phase-6-verify",
      "children": [],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "agent": "sdd-fidelity-review",
        "scope": "phase",
        "target": "phase-6"
      }
    }
  },
  "journal": [
    {
      "timestamp": "2025-11-20T23:51:40.973992Z",
      "entry_type": "status_change",
      "title": "Task Completed: Analyze codebase.json vs documentation.json relationship",
      "author": "claude-code",
      "content": "Investigated the relationship between codebase.json (generated by llm-doc-gen) and documentation.json (used by doc-query).\n\nKey Findings:\n\n1. **They are the SAME format** - No translation layer needed\n   - Both follow schema v2.0 defined in llm_doc_gen/analysis/schema.py\n   - Both use identical top-level structure: metadata, statistics, modules, classes, functions, dependencies\n   - doc-query expects a file called \"documentation.json\" but can consume the exact output from llm-doc-gen\n\n2. **Current naming convention**:\n   - llm-doc-gen outputs to \"codebase.json\" by default (in docs/)\n   - doc-query looks for \"documentation.json\" by default (in docs/)\n   - These are just different names for the same format\n\n3. **Schema details** (schema v2.0):\n   - Base structure: metadata (project_name, version, generated_at, languages, schema_version)\n   - Statistics: total counts, complexity metrics, language breakdowns\n   - Modules: list of parsed files with their classes/functions/dependencies\n   - Classes: with optional usage tracking (instantiated_by, imported_by, instantiation_count)\n   - Functions: with optional cross-references (callers, calls, call_count)\n   - Dependencies: module-to-module dependency mapping\n\n4. **doc_query normalization**:\n   - doc_query_lib.py has a _normalize_data() method that makes the schema flexible\n   - It fills in missing fields with defaults (e.g., empty arrays for methods, properties, decorators)\n   - It handles both v1.0 and v2.0 schemas through optional fields\n\n5. **Integration path**:\n   - Option A: llm-doc-gen can output directly to \"documentation.json\" (just change output filename)\n   - Option B: doc-query can be configured to read \"codebase.json\"\n   - Option C: Create a symlink or copy (minimal overhead since they're identical formats)\n\n6. **Cross-reference enhancement**:\n   - Schema v2.0 supports cross-reference tracking (callers/calls for functions)\n   - doc-query already has methods to query these: get_callers(), get_callees(), get_call_count(), build_call_graph()\n   - The enhancement functions in schema.py are opt-in: enhance_function_with_cross_refs(), enhance_class_with_usage_tracking()\n\nFiles examined:\n- docs/codebase.json\n- src/claude_skills/claude_skills/llm_doc_gen/analysis/schema.py\n- src/claude_skills/claude_skills/llm_doc_gen/analysis/formatter.py\n- src/claude_skills/claude_skills/llm_doc_gen/analysis/generator.py\n- src/claude_skills/claude_skills/doc_query/doc_query_lib.py\n\nNo code changes made - this was an investigation task only.",
      "metadata": {},
      "task_id": "task-1-1"
    },
    {
      "timestamp": "2025-11-20T23:53:00.431961Z",
      "entry_type": "status_change",
      "title": "Task Completed: Review existing doc_query capabilities",
      "author": "claude-code",
      "content": "Reviewed existing doc_query capabilities and workflows to identify reusable components for llm-doc-gen integration.\n\nCore Query Capabilities (doc_query_lib.py):\n1. Basic entity queries: find_class, find_function, find_module, list_* methods\n2. Cross-reference queries (Schema v2.0): get_callers, get_callees, get_call_count, build_call_graph\n3. Complexity analysis: get_high_complexity, complexity statistics in module summaries\n4. Dependency tracking: get_dependencies, module-level dependency mapping\n5. Context gathering: get_context_for_area, describe_module, search_entities\n\nAdvanced Workflows:\n1. Impact Analysis (workflows/impact_analysis.py) - Calculate blast radius for code changes\n2. Refactor Candidates (workflows/refactor_candidates.py) - Prioritize tech debt\n3. Data Lifecycle Tracing (workflows/trace_data.py) - Track class usage\n4. Execution Flow Tracing (workflows/trace_entry.py) - Call chain traversal\n\nCapabilities Reusable for llm-doc-gen:\n\u2705 Already compatible (use as-is): All basic query methods, cross-reference queries, dependency tracking, context gathering\n\u2705 Highly reusable (minimal adaptation): Impact analysis, refactor candidate detection, layer detection logic, complexity analysis\n\u2705 Conceptually reusable (needs redesign): Data lifecycle tracing, execution flow tracing, risk assessment algorithms\n\nGaps to Fill:\n1. Missing from doc_query: AI-powered narrative generation, markdown documentation generation, project overview generation, architecture pattern detection, component relationship visualization, tutorial/guide generation\n2. Integration opportunities: llm-doc-gen can leverage doc_query workflows for Insights sections (Impact analysis \u2192 Change Impact insights, Refactor candidates \u2192 Tech Debt insights, Complexity hot spots \u2192 Complexity Warnings, Call graphs \u2192 Dependency Visualizations)\n\nArchitecture insight: doc_query is a pure query engine providing data retrieval without AI/narrative generation. This makes it perfect for integration - llm-doc-gen can use doc_query methods to gather structured data, then feed that data to AI models for narrative generation.\n\nFiles reviewed:\n- src/claude_skills/claude_skills/doc_query/doc_query_lib.py (1724 lines)\n- src/claude_skills/claude_skills/doc_query/workflows/impact_analysis.py (767 lines)\n- src/claude_skills/claude_skills/doc_query/workflows/refactor_candidates.py (521 lines)\n- src/claude_skills/claude_skills/doc_query/workflows/trace_data.py (604 lines)\n- src/claude_skills/claude_skills/doc_query/workflows/trace_entry.py (462 lines)\n\nNo code changes made - this was an investigation task only.",
      "metadata": {},
      "task_id": "task-1-2"
    },
    {
      "timestamp": "2025-11-20T23:54:09.267404Z",
      "entry_type": "status_change",
      "title": "Task Completed: Define metrics to extract based on consensus feedback",
      "author": "claude-code",
      "content": "Defined comprehensive metrics to extract for analysis insights, organized by priority and generator focus.\n\n**Priority 1 Metrics** (Implement First):\n1. Most Called Functions (Hotspots) - Sort by call_count from schema v2.0\n2. High Complexity Functions - Filter by complexity >= 10\n3. Entry Points - Functions with zero callers or heuristic-based detection\n4. Cross-Module Dependencies - Count and cycle detection\n\n**Priority 2 Metrics** (Implement After Core):\n5. Instantiated Classes - Sort by instantiation_count\n6. Module Complexity Ranking - Aggregate function complexities per module\n7. Fan-Out Analysis - Flag functions calling >5 others\n8. Dependency Clusters - Detect tightly coupled module groups\n9. Impact Radius - Bidirectional blast radius analysis\n10. Refactor Priority Score - Complexity \u00d7 dependent_count\n\n**Per-Generator Focus**:\n- Architecture Generator: Cross-module dependencies, module complexity, dependency clusters, most called functions\n- Component Generator: High complexity functions, instantiated classes, fan-out analysis, impact radius\n- Overview Generator: Entry points, refactor priority score, top-level statistics\n\n**Implementation Strategy**:\n- All metrics computed from schema v2.0 (no additional parsing)\n- Reuse workflows from doc_query as libraries\n- Compute during documentation generation with caching in analysis_insights.py module\n- Metrics provide data for AI prompts, AI generators create narrative\n\n**Decision rationale**: Priority 1 focuses on most valuable insights (complexity, entry points, dependencies, call frequency). Priority 2 and advanced metrics add depth without overwhelming users. Clear implementation guidance for tasks 2-1 (analysis_cache) and 1-4 (module architecture).",
      "metadata": {},
      "task_id": "task-1-3"
    }
  ]
}