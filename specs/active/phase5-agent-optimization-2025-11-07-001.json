{
  "spec_id": "phase5-agent-optimization-2025-11-07-001",
  "generated": "2025-11-07T17:20:00Z",
  "last_updated": "2025-11-07T17:39:58.310615Z",
  "hierarchy": {
    "spec-root": {
      "type": "spec",
      "title": "Phase 5: AI-Agent Performance Optimization",
      "status": "in_progress",
      "parent": null,
      "children": [
        "phase-1",
        "phase-2",
        "phase-3",
        "phase-4"
      ],
      "total_tasks": 38,
      "completed_tasks": 3,
      "metadata": {
        "description": "Replace interactive TUI features with AI-agent-optimized streaming output and smart caching",
        "objectives": [
          "Provide real-time progress feedback via structured event streams",
          "Cache AI consultation results to reduce API costs and latency",
          "Enable incremental reviews for faster iteration",
          "Integrate streaming with caching for comprehensive monitoring"
        ],
        "estimated_hours": 20,
        "complexity": "medium-high"
      }
    },
    "phase-1": {
      "type": "phase",
      "title": "AI Consultation Cache Foundation",
      "status": "in_progress",
      "parent": "spec-root",
      "children": [
        "phase-1-files",
        "phase-1-verify"
      ],
      "total_tasks": 14,
      "completed_tasks": 3,
      "metadata": {
        "purpose": "Build file-based caching system for AI model responses with TTL and invalidation",
        "risk_level": "low",
        "estimated_hours": 8
      },
      "dependencies": {
        "blocks": [
          "phase-2",
          "phase-3",
          "phase-4"
        ]
      }
    },
    "phase-1-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "in_progress",
      "parent": "phase-1",
      "children": [
        "task-1-1",
        "task-1-2",
        "task-1-3",
        "task-1-4",
        "task-1-5"
      ],
      "total_tasks": 9,
      "completed_tasks": 3,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-1-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-1": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/common/cache.py",
      "status": "completed",
      "parent": "phase-1-files",
      "children": [
        "task-1-1-1",
        "task-1-1-2",
        "task-1-1-3"
      ],
      "dependencies": {
        "blocks": [
          "task-1-2",
          "task-1-3",
          "task-1-4"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 3,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/common/cache.py",
        "task_category": "implementation",
        "estimated_hours": 3,
        "changes": "Create CacheManager class with get/set/invalidate/clear methods, hash-based key generation, TTL support",
        "reasoning": "Centralized cache logic for reuse across all AI consultation features",
        "integration_points": "Used by fidelity-review and plan-review modules"
      }
    },
    "task-1-1-1": {
      "type": "subtask",
      "title": "Implement CacheManager class with file-based storage",
      "status": "completed",
      "parent": "task-1-1",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-1-1-2",
          "task-1-1-3"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "estimated_hours": 1.5,
        "started_at": "2025-11-07T17:34:07.483874Z",
        "completed_at": "2025-11-07T17:35:37.146174Z",
        "needs_journaling": false,
        "actual_hours": 0.025,
        "journaled_at": "2025-11-07T17:35:37.157169Z"
      }
    },
    "task-1-1-2": {
      "type": "subtask",
      "title": "Add hash-based cache key generation (spec + files + model + prompt version)",
      "status": "completed",
      "parent": "task-1-1",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-1-1-1"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "estimated_hours": 1,
        "task_category": "implementation",
        "started_at": "2025-11-07T17:36:03.049944Z",
        "completed_at": "2025-11-07T17:37:28.998713Z",
        "needs_journaling": false,
        "actual_hours": 0.024,
        "journaled_at": "2025-11-07T17:37:29.003496Z"
      }
    },
    "task-1-1-3": {
      "type": "subtask",
      "title": "Implement TTL expiration and automatic cleanup",
      "status": "completed",
      "parent": "task-1-1",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-1-1-1"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "estimated_hours": 0.5,
        "task_category": "implementation",
        "started_at": "2025-11-07T17:38:08.101102Z",
        "completed_at": "2025-11-07T17:39:58.300145Z",
        "needs_journaling": false,
        "actual_hours": 0.031,
        "journaled_at": "2025-11-07T17:39:58.307389Z"
      }
    },
    "task-1-2": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/common/config.py",
      "status": "pending",
      "parent": "phase-1-files",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-1-3"
        ],
        "blocked_by": [
          "task-1-1"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/common/config.py",
        "task_category": "implementation",
        "estimated_hours": 1,
        "changes": "Add cache configuration section with enabled/directory/ttl_seconds/max_size_mb settings",
        "reasoning": "Global configuration for cache behavior",
        "integration_points": "Read by CacheManager at initialization"
      }
    },
    "task-1-3": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/sdd_fidelity_review/consultation.py",
      "status": "pending",
      "parent": "phase-1-files",
      "children": [
        "task-1-3-1",
        "task-1-3-2"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-1-1",
          "task-1-2"
        ],
        "depends": []
      },
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/sdd_fidelity_review/consultation.py",
        "task_category": "refactoring",
        "estimated_hours": 2,
        "changes": "Integrate CacheManager into consult_multiple_ai_on_fidelity function, check cache before API calls, save responses to cache",
        "reasoning": "Enable caching for fidelity review AI consultations",
        "integration_points": "Uses CacheManager from common.cache"
      }
    },
    "task-1-3-1": {
      "type": "subtask",
      "title": "Add cache lookup before AI consultation",
      "status": "pending",
      "parent": "task-1-3",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-1-3-2"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "estimated_hours": 1
      }
    },
    "task-1-3-2": {
      "type": "subtask",
      "title": "Save AI responses to cache after consultation",
      "status": "pending",
      "parent": "task-1-3",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-1-3-1"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "estimated_hours": 1,
        "task_category": "implementation"
      }
    },
    "task-1-4": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/cli/cache_commands.py",
      "status": "pending",
      "parent": "phase-1-files",
      "children": [
        "task-1-4-1",
        "task-1-4-2"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-1-1"
        ],
        "depends": []
      },
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/cli/cache_commands.py",
        "task_category": "implementation",
        "estimated_hours": 1.5,
        "changes": "Create CLI commands for cache management: info, clear, stats",
        "reasoning": "User-facing cache management interface",
        "integration_points": "Integrated into main sdd CLI"
      }
    },
    "task-1-4-1": {
      "type": "subtask",
      "title": "Implement 'sdd cache info' command (shows cache location, size, hit rate)",
      "status": "pending",
      "parent": "task-1-4",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "estimated_hours": 0.75
      }
    },
    "task-1-4-2": {
      "type": "subtask",
      "title": "Implement 'sdd cache clear' command with --type and --spec filters",
      "status": "pending",
      "parent": "task-1-4",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "estimated_hours": 0.75
      }
    },
    "task-1-5": {
      "type": "task",
      "title": "Remove textual dependency from pyproject.toml",
      "status": "pending",
      "parent": "phase-1-files",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/pyproject.toml",
        "task_category": "refactoring",
        "estimated_hours": 0.25,
        "changes": "Remove [tui] optional dependency group with textual",
        "reasoning": "Textual not needed for AI-agent-first toolkit, was added for human-interactive features",
        "integration_points": "None - cleanup only"
      }
    },
    "phase-1-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-1",
      "children": [
        "verify-1-1",
        "verify-1-2",
        "verify-1-3",
        "verify-1-4",
        "verify-1-5"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-1-files"
        ],
        "depends": []
      },
      "total_tasks": 5,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-1-1": {
      "type": "verify",
      "title": "Cache stores and retrieves AI responses correctly",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/unit/test_cache.py -v",
        "expected": "All cache CRUD operations pass"
      }
    },
    "verify-1-2": {
      "type": "verify",
      "title": "TTL expiration works correctly",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/unit/test_cache.py::test_ttl_expiration -v",
        "expected": "Expired cache entries not returned"
      }
    },
    "verify-1-3": {
      "type": "verify",
      "title": "Fidelity review uses cache on second run",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "checklist": [
          "Run fidelity-review twice on same spec",
          "Verify second run is instant (cache hit)",
          "Check .sdd/cache/ directory contains cached responses"
        ],
        "command": "",
        "expected": ""
      }
    },
    "verify-1-4": {
      "type": "verify",
      "title": "Cache commands work correctly",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "checklist": [
          "Run 'sdd cache info' - shows cache stats",
          "Run 'sdd cache clear' - clears cache",
          "Verify cache directory emptied"
        ],
        "command": "",
        "expected": ""
      }
    },
    "verify-1-5": {
      "type": "verify",
      "title": "Phase 1 implementation fidelity review",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "agent": "sdd-fidelity-review",
        "scope": "phase",
        "target": "phase-1"
      }
    },
    "phase-2": {
      "type": "phase",
      "title": "Structured Event Streaming",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-2-files",
        "phase-2-verify"
      ],
      "dependencies": {
        "blocks": [
          "phase-4"
        ],
        "blocked_by": [
          "phase-1"
        ],
        "depends": []
      },
      "total_tasks": 10,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Implement JSON event streaming on stderr for real-time progress monitoring",
        "risk_level": "low",
        "estimated_hours": 5
      }
    },
    "phase-2-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-2",
      "children": [
        "task-2-1",
        "task-2-2",
        "task-2-3",
        "task-2-4"
      ],
      "total_tasks": 5,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-2-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-1": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/common/progress.py",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [
        "task-2-1-1",
        "task-2-1-2"
      ],
      "dependencies": {
        "blocks": [
          "task-2-2",
          "task-2-3"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/common/progress.py",
        "task_category": "implementation",
        "estimated_hours": 2,
        "changes": "Create ProgressEmitter class that emits JSON events to stderr",
        "reasoning": "Centralized progress event emission for all long-running operations",
        "integration_points": "Used by consultation, review, and documentation generation modules"
      }
    },
    "task-2-1-1": {
      "type": "subtask",
      "title": "Implement ProgressEmitter with emit() method for JSON events",
      "status": "pending",
      "parent": "task-2-1",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-2-1-2"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "estimated_hours": 1
      }
    },
    "task-2-1-2": {
      "type": "subtask",
      "title": "Add TTY detection and auto-disable in non-interactive environments",
      "status": "pending",
      "parent": "task-2-1",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-2-1-1"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "estimated_hours": 1,
        "task_category": "implementation"
      }
    },
    "task-2-2": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/sdd_fidelity_review/consultation.py",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-2-1"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/sdd_fidelity_review/consultation.py",
        "task_category": "refactoring",
        "estimated_hours": 1.5,
        "changes": "Integrate ProgressEmitter, emit events for: cache_check, ai_consultation, model_response, cache_save, complete",
        "reasoning": "Enable real-time monitoring of fidelity review operations",
        "integration_points": "Emits cache hit/miss information from Phase 1"
      }
    },
    "task-2-3": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/sdd_fidelity_review/cli.py",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-2-1"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/sdd_fidelity_review/cli.py",
        "task_category": "refactoring",
        "estimated_hours": 1,
        "changes": "Add --stream-progress flag to fidelity-review command, pass to ProgressEmitter",
        "reasoning": "User-facing control over event streaming",
        "integration_points": "Enables/disables ProgressEmitter in consultation.py"
      }
    },
    "task-2-4": {
      "type": "task",
      "title": "Remove obsolete Phase 5 tasks from TUI upgrade spec",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "specs/active/tui-upgrade-2025-11-06-001.json",
        "task_category": "decision",
        "estimated_hours": 0.5,
        "changes": "Mark remaining Phase 5 tasks (task-5-2, task-5-3) as cancelled/archived, document decision to replace with agent-optimized features",
        "reasoning": "Original Phase 5 interactive features don't align with AI-agent-first philosophy",
        "integration_points": "None - cleanup/documentation"
      }
    },
    "phase-2-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-2",
      "children": [
        "verify-2-1",
        "verify-2-2",
        "verify-2-3",
        "verify-2-4",
        "verify-2-5"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-2-files"
        ],
        "depends": []
      },
      "total_tasks": 5,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-2-1": {
      "type": "verify",
      "title": "ProgressEmitter emits valid JSON events",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/unit/test_progress.py -v",
        "expected": "All events are valid JSON with correct schema"
      }
    },
    "verify-2-2": {
      "type": "verify",
      "title": "Events include cache hit/miss information",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "checklist": [
          "Run fidelity-review with --stream-progress",
          "Verify cache_check event shows hits/misses",
          "Verify model_response events include 'source': 'cache' or 'api'"
        ],
        "command": "",
        "expected": ""
      }
    },
    "verify-2-3": {
      "type": "verify",
      "title": "TTY detection disables events in non-interactive mode",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/unit/test_progress.py::test_tty_detection -v",
        "expected": "Events disabled when not TTY"
      }
    },
    "verify-2-4": {
      "type": "verify",
      "title": "Streaming works end-to-end with AI consultation",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "checklist": [
          "Run fidelity-review with --stream-progress 2>events.jsonl",
          "Monitor events.jsonl while review runs",
          "Verify events appear in real-time (not buffered)",
          "Confirm all expected event types present"
        ],
        "command": "",
        "expected": ""
      }
    },
    "verify-2-5": {
      "type": "verify",
      "title": "Phase 2 implementation fidelity review",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "agent": "sdd-fidelity-review",
        "scope": "phase",
        "target": "phase-2"
      }
    },
    "phase-3": {
      "type": "phase",
      "title": "Incremental Review",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-3-files",
        "phase-3-verify"
      ],
      "dependencies": {
        "blocks": [
          "phase-4"
        ],
        "blocked_by": [
          "phase-1"
        ],
        "depends": [
          "phase-2"
        ]
      },
      "total_tasks": 9,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Enable delta-based reviews that only analyze changed files",
        "risk_level": "medium",
        "estimated_hours": 5
      }
    },
    "phase-3-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-3",
      "children": [
        "task-3-1",
        "task-3-2",
        "task-3-3"
      ],
      "total_tasks": 4,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-3-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-1": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/common/cache.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-3-2"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/common/cache.py",
        "task_category": "implementation",
        "estimated_hours": 2,
        "changes": "Add get_incremental_state() and save_incremental_state() methods to track file hashes",
        "reasoning": "Store previous file hashes to detect changes between runs",
        "integration_points": "Used by fidelity review to determine which files changed"
      }
    },
    "task-3-2": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/sdd_fidelity_review/review.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [
        "task-3-2-1",
        "task-3-2-2"
      ],
      "dependencies": {
        "blocks": [
          "task-3-3"
        ],
        "blocked_by": [
          "task-3-1"
        ],
        "depends": []
      },
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/sdd_fidelity_review/review.py",
        "task_category": "implementation",
        "estimated_hours": 2.5,
        "changes": "Add incremental review logic: compare current vs saved file hashes, only review changed files, merge with cached results",
        "reasoning": "Core incremental review implementation",
        "integration_points": "Uses CacheManager for both hash storage and cached results"
      }
    },
    "task-3-2-1": {
      "type": "subtask",
      "title": "Implement file hash comparison to detect changes",
      "status": "pending",
      "parent": "task-3-2",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-3-2-2"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "estimated_hours": 1.25
      }
    },
    "task-3-2-2": {
      "type": "subtask",
      "title": "Merge cached results for unchanged files with fresh results",
      "status": "pending",
      "parent": "task-3-2",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-3-2-1"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "estimated_hours": 1.25,
        "task_category": "implementation"
      }
    },
    "task-3-3": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/sdd_fidelity_review/cli.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-3-2"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/sdd_fidelity_review/cli.py",
        "task_category": "refactoring",
        "estimated_hours": 0.5,
        "changes": "Add --incremental flag to fidelity-review command",
        "reasoning": "User-facing control over incremental mode",
        "integration_points": "Enables incremental logic in review.py"
      }
    },
    "phase-3-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-3",
      "children": [
        "verify-3-1",
        "verify-3-2",
        "verify-3-3",
        "verify-3-4",
        "verify-3-5"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-3-files"
        ],
        "depends": []
      },
      "total_tasks": 5,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-3-1": {
      "type": "verify",
      "title": "File hash detection works correctly",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/unit/test_incremental.py -v",
        "expected": "Hash comparison correctly identifies changed files"
      }
    },
    "verify-3-2": {
      "type": "verify",
      "title": "Incremental review only analyzes changed files",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "checklist": [
          "Run fidelity-review on spec with 5 files",
          "Modify 1 file",
          "Run fidelity-review --incremental",
          "Verify only 1 file was reviewed (check logs/events)",
          "Verify report includes all 5 files (merged results)"
        ],
        "command": "",
        "expected": ""
      }
    },
    "verify-3-3": {
      "type": "verify",
      "title": "Merged results maintain consensus accuracy",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/integration/test_incremental_consensus.py -v",
        "expected": "Consensus calculation includes both cached and fresh results"
      }
    },
    "verify-3-4": {
      "type": "verify",
      "title": "Incremental mode works with streaming",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "checklist": [
          "Run fidelity-review --incremental --stream-progress 2>events.jsonl",
          "Verify cache_check event shows which files changed",
          "Verify only changed files generate model_response events",
          "Confirm time_saved metric in complete event"
        ],
        "command": "",
        "expected": ""
      }
    },
    "verify-3-5": {
      "type": "verify",
      "title": "Phase 3 implementation fidelity review",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "agent": "sdd-fidelity-review",
        "scope": "phase",
        "target": "phase-3"
      }
    },
    "phase-4": {
      "type": "phase",
      "title": "Integration & Documentation",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-4-files",
        "phase-4-verify"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-1",
          "phase-2",
          "phase-3"
        ],
        "depends": []
      },
      "total_tasks": 5,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Final integration testing and documentation for Phase 5 features",
        "risk_level": "low",
        "estimated_hours": 2
      }
    },
    "phase-4-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-4",
      "children": [
        "task-4-1",
        "task-4-2"
      ],
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-4-verify"
        ]
      }
    },
    "task-4-1": {
      "type": "task",
      "title": "tests/integration/test_streaming_cache.py",
      "status": "pending",
      "parent": "phase-4-files",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "tests/integration/test_streaming_cache.py",
        "task_category": "implementation",
        "estimated_hours": 1.5,
        "changes": "Create integration tests for streaming + caching interaction",
        "reasoning": "Validate end-to-end integration of Phase 5 features",
        "integration_points": "Tests all three phases together"
      }
    },
    "task-4-2": {
      "type": "task",
      "title": "docs/PHASE5_AGENT_OPTIMIZATION.md",
      "status": "pending",
      "parent": "phase-4-files",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "docs/PHASE5_AGENT_OPTIMIZATION.md",
        "task_category": "implementation",
        "estimated_hours": 0.5,
        "changes": "Document streaming and caching features for AI agents",
        "reasoning": "User-facing documentation for new features",
        "integration_points": "References all Phase 5 capabilities"
      }
    },
    "phase-4-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-4",
      "children": [
        "verify-4-1",
        "verify-4-2",
        "verify-4-3"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-4-files"
        ],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-4-1": {
      "type": "verify",
      "title": "All integration tests pass",
      "status": "pending",
      "parent": "phase-4-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "agent": "run-tests",
        "command": "pytest tests/integration/test_streaming_cache.py -v",
        "expected": "All streaming + caching integration tests pass"
      }
    },
    "verify-4-2": {
      "type": "verify",
      "title": "Documentation is complete and accurate",
      "status": "pending",
      "parent": "phase-4-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "checklist": [
          "Review docs/PHASE5_AGENT_OPTIMIZATION.md",
          "Verify all features documented with examples",
          "Check configuration options explained",
          "Confirm AI agent workflow examples provided"
        ],
        "command": "",
        "expected": ""
      }
    },
    "verify-4-3": {
      "type": "verify",
      "title": "Phase 4 implementation fidelity review",
      "status": "pending",
      "parent": "phase-4-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "fidelity",
        "agent": "sdd-fidelity-review",
        "scope": "phase",
        "target": "phase-4"
      }
    }
  },
  "metadata": {
    "status": "active",
    "activated_date": "2025-11-07T17:33:28.331361Z",
    "progress_percentage": 7,
    "current_phase": "phase-1"
  },
  "journal": [
    {
      "timestamp": "2025-11-07T17:35:37.157150Z",
      "entry_type": "status_change",
      "title": "Task Completed: Implement CacheManager class with file-based storage",
      "author": "claude-code",
      "content": "Successfully implemented CacheManager class with file-based storage. Created cache module at src/claude_skills/claude_skills/common/cache/ with CacheManager class supporting get/set/delete/clear operations, TTL expiration, atomic file operations, graceful error handling, and cache statistics. Added comprehensive unit tests (11 tests) covering all functionality including TTL expiration, atomic writes, key sanitization, and error handling. All tests pass.",
      "metadata": {},
      "task_id": "task-1-1-1"
    },
    {
      "timestamp": "2025-11-07T17:37:29.003484Z",
      "entry_type": "status_change",
      "title": "Task Completed: Add hash-based cache key generation (spec + files + model + prompt version)",
      "author": "claude-code",
      "content": "Successfully implemented hash-based cache key generation. Created cache_key.py module with generate_cache_key() function supporting deterministic keys based on spec ID, file contents hash, model name, prompt version, and extra parameters. Implemented specialized key generators for fidelity reviews (generate_fidelity_review_key) and plan reviews (generate_plan_review_key). Added key validation function. Keys are deterministic, file-order independent, and change automatically when inputs change. Comprehensive test suite with 17 tests covering all scenarios including file changes, parameter ordering, missing files, and complex scenarios. All tests pass.",
      "metadata": {},
      "task_id": "task-1-1-2"
    },
    {
      "timestamp": "2025-11-07T17:39:58.307363Z",
      "entry_type": "status_change",
      "title": "Task Completed: Implement TTL expiration and automatic cleanup",
      "author": "claude-code",
      "content": "Successfully implemented automatic cleanup for expired cache entries. Added auto_cleanup parameter to CacheManager constructor (enabled by default), CLEANUP_INTERVAL_HOURS constant (1 hour), and _maybe_cleanup() method that runs periodically during get/set operations. Cleanup respects the interval to avoid excessive overhead. Initial cleanup runs on cache initialization. Added 4 comprehensive tests covering automatic cleanup disabled/enabled, interval respect, and initial cleanup. All 15 cache manager tests pass including the 4 new automatic cleanup tests.",
      "metadata": {},
      "task_id": "task-1-1-3"
    }
  ]
}