{
  "spec_id": "doc-query-enhancements-2025-10-24-001",
  "generated": "2025-10-24T00:00:00Z",
  "last_updated": "2025-10-26T13:11:33.632181+00:00",
  "metadata": {
    "title": "Doc-Query CLI Enhancement",
    "description": "Enhance doc-query skill with workflow automation, cross-reference tracking, and improved UX to reduce manual command chaining from 6-8 steps to 1 step for common workflows",
    "status": "approved",
    "priority": "high",
    "estimated_hours": 230,
    "complexity": "high",
    "objectives": [
      "Fix critical reverse dependency support",
      "Add cross-reference data (callers/callees) to schema v2.0",
      "Implement 4 core wrapper commands reducing workflows by 80%",
      "Add native pattern filtering to eliminate grep dependencies",
      "Improve impact analysis accuracy from ~60% to ~95%"
    ],
    "success_criteria": [
      "All P0 blockers resolved (reverse deps + cross-refs)",
      "trace-entry, trace-data, impact, refactor-candidates commands working",
      "Workflows reduced from 6-8 commands to 1 command",
      "Native filtering working on list-modules, complexity commands",
      "Impact analysis uses cross-refs instead of search fallback"
    ],
    "security_considerations": [
      "All generated outputs (dot files, JSON) sanitized to prevent injection",
      "Local developer tool - no network exposure or remote data transmission",
      "No sensitive data handling - reads source code only",
      "Output sanitization tested with crafted function names containing special characters"
    ],
    "review": {
      "status": "approved",
      "score": 8.8,
      "date": "2025-10-24",
      "reviewer": "gemini-2.5-pro",
      "recommendation": "APPROVE with timeline revision",
      "key_revisions": [
        "Phase 2 estimate increased from 80 to 110 hours",
        "Added dynamic Python mitigation strategy",
        "Added security considerations"
      ]
    }
  },
  "hierarchy": {
    "spec-root": {
      "type": "spec",
      "title": "Doc-Query CLI Enhancement",
      "status": "in_progress",
      "parent": null,
      "children": [
        "phase-1",
        "phase-2",
        "phase-3",
        "phase-4"
      ],
      "total_tasks": 46,
      "completed_tasks": 4,
      "metadata": {}
    },
    "phase-1": {
      "type": "phase",
      "title": "P0: Foundation - Critical Fixes",
      "status": "in_progress",
      "parent": "spec-root",
      "children": [
        "phase-1-files",
        "phase-1-verify"
      ],
      "total_tasks": 21,
      "completed_tasks": 4,
      "metadata": {
        "purpose": "Fix critical blockers: reverse dependency support and cross-reference generation",
        "risk_level": "high",
        "estimated_hours": 40,
        "dependencies": "None - foundational work"
      },
      "dependencies": {
        "blocks": [
          "phase-2"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "phase-1-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "in_progress",
      "parent": "phase-1",
      "children": [
        "task-1-1",
        "task-1-2",
        "task-1-3",
        "task-1-4",
        "task-1-5"
      ],
      "total_tasks": 16,
      "completed_tasks": 4,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-1-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-1-1": {
      "type": "task",
      "title": "Verify reverse dependency support",
      "status": "completed",
      "parent": "phase-1-files",
      "children": [
        "task-1-1-1",
        "task-1-1-2",
        "task-1-1-3"
      ],
      "dependencies": {
        "blocks": [
          "task-1-2"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 3,
      "metadata": {
        "description": "Inspect documentation.json schema and test reverse dependency functionality",
        "estimated_hours": 4,
        "file_path": "investigation",
        "completed_at": "2025-10-26T12:49:43.900206+00:00",
        "needs_journaling": false,
        "status_note": "Verified reverse dependency support is implemented and working. Added comprehensive documentation to SKILL.md clarifying import names vs file paths. Created findings report and enhancement summary.",
        "journaled_at": "2025-10-26T13:11:33.632127+00:00"
      }
    },
    "task-1-1-1": {
      "type": "subtask",
      "title": "Inspect documentation.json schema for reverse dependency data",
      "status": "completed",
      "parent": "task-1-1",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-1-1-2"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "actions": [
          "Check if imported_by field exists in modules",
          "Verify reverse dependency tracking in current schema"
        ],
        "completed_at": "2025-10-26T12:49:57.511971+00:00",
        "needs_journaling": true,
        "status_note": "Inspected documentation.json schema - reverse dependency data structure confirmed"
      }
    },
    "task-1-1-2": {
      "type": "subtask",
      "title": "Test sdd doc dependencies --reverse on real codebase",
      "status": "completed",
      "parent": "task-1-1",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-1-1-3"
        ],
        "blocked_by": [
          "task-1-1-1"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "actions": [
          "Run dependencies --reverse on multiple modules",
          "Verify completeness and accuracy of results"
        ],
        "completed_at": "2025-10-26T12:50:03.613182+00:00",
        "needs_journaling": true,
        "status_note": "Tested sdd doc dependencies --reverse - verified it works with import names, identified file path limitation"
      }
    },
    "task-1-1-3": {
      "type": "subtask",
      "title": "Document findings and determine if fix needed",
      "status": "completed",
      "parent": "task-1-1",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-1-1-2"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "actions": [
          "Create report of reverse dependency status",
          "Identify gaps if any",
          "Estimate effort to fix"
        ],
        "completed_at": "2025-10-26T12:50:08.718817+00:00",
        "needs_journaling": true,
        "status_note": "Created comprehensive findings report and documentation enhancement. Determined no fix needed - feature working as designed."
      }
    },
    "task-1-2": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/code_doc/ast_analysis.py",
      "status": "in_progress",
      "parent": "phase-1-files",
      "children": [
        "task-1-2-1",
        "task-1-2-2",
        "task-1-2-3",
        "task-1-2-4"
      ],
      "dependencies": {
        "blocks": [
          "task-1-3"
        ],
        "blocked_by": [
          "task-1-1"
        ],
        "depends": []
      },
      "total_tasks": 4,
      "completed_tasks": 1,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/code_doc/ast_analysis.py",
        "description": "Add cross-reference tracking during AST analysis to capture caller/callee relationships",
        "estimated_hours": 16,
        "started_at": "2025-10-26T13:04:56.533668+00:00",
        "status_note": "Starting Python parser integration for function call tracking"
      }
    },
    "task-1-2-1": {
      "type": "subtask",
      "title": "Implement function call tracking during AST traversal",
      "status": "completed",
      "parent": "task-1-2",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-1-2-3"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 1,
      "metadata": {
        "changes": [
          "Add call tracking in AST visitor",
          "Capture function call expressions",
          "Store caller/callee relationships",
          "Track call locations (file, line)"
        ],
        "started_at": "2025-10-26T13:10:36.152165+00:00",
        "status_note": "CallTracker AST visitor implemented with 11 passing tests. Tracks 82 calls in python.py successfully.",
        "completed_at": "2025-10-26T13:11:06.412486+00:00",
        "needs_journaling": true
      }
    },
    "task-1-2-2": {
      "type": "subtask",
      "title": "Implement import tracking for class instantiation",
      "status": "pending",
      "parent": "task-1-2",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-1-2-3"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Track import statements",
          "Capture class instantiation points",
          "Record imported_by relationships",
          "Store instantiated_by data"
        ]
      }
    },
    "task-1-2-3": {
      "type": "subtask",
      "title": "Build bidirectional reference graph",
      "status": "pending",
      "parent": "task-1-2",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-1-2-1",
          "task-1-2-2"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Create caller/callee graph structure",
          "Maintain bidirectional references",
          "Support reverse lookups"
        ]
      }
    },
    "task-1-2-4": {
      "type": "subtask",
      "title": "Add warning system for dynamic Python patterns",
      "status": "pending",
      "parent": "task-1-2",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Detect decorators, monkey-patching, and reflection during AST analysis",
          "Log warnings when dynamic patterns are found that may affect cross-reference accuracy",
          "Document limitations in generated documentation.json metadata",
          "Add coverage statistics for dynamic vs static call detection"
        ],
        "rationale": "Dynamic Python features (decorators, monkey-patching, reflection) can bypass static AST analysis, leading to incomplete cross-reference data. Explicit warnings help users understand accuracy limits."
      }
    },
    "task-1-3": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/code_doc/schema.py",
      "status": "pending",
      "parent": "phase-1-files",
      "children": [
        "task-1-3-1",
        "task-1-3-2",
        "task-1-3-3"
      ],
      "dependencies": {
        "blocks": [
          "task-1-4"
        ],
        "blocked_by": [
          "task-1-2"
        ],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/code_doc/schema.py",
        "description": "Update schema to v2.0 with cross-reference fields",
        "estimated_hours": 8
      }
    },
    "task-1-3-1": {
      "type": "subtask",
      "title": "Add callers and calls fields to function schema",
      "status": "pending",
      "parent": "task-1-3",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-1-3-3"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Add callers array with name, file, line, call_type",
          "Add calls array with name, file, line, call_type",
          "Add optional call_count field"
        ]
      }
    },
    "task-1-3-2": {
      "type": "subtask",
      "title": "Add usage tracking fields to class schema",
      "status": "pending",
      "parent": "task-1-3",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-1-3-3"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Add instantiated_by array",
          "Add imported_by array",
          "Add property_access tracking (optional for v2.0)"
        ]
      }
    },
    "task-1-3-3": {
      "type": "subtask",
      "title": "Update schema version to 2.0",
      "status": "pending",
      "parent": "task-1-3",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-1-3-1",
          "task-1-3-2"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Update schema_version field",
          "Add migration notes",
          "Document backward compatibility approach"
        ]
      }
    },
    "task-1-4": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/doc_query/doc_query_lib.py",
      "status": "pending",
      "parent": "phase-1-files",
      "children": [
        "task-1-4-1",
        "task-1-4-2",
        "task-1-4-3"
      ],
      "dependencies": {
        "blocks": [
          "task-1-5"
        ],
        "blocked_by": [
          "task-1-3"
        ],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/doc_query/doc_query_lib.py",
        "description": "Add query functions for cross-references",
        "estimated_hours": 8
      }
    },
    "task-1-4-1": {
      "type": "subtask",
      "title": "Implement get_callers() function",
      "status": "pending",
      "parent": "task-1-4",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-1-4-3"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Query callers from function data",
          "Return formatted caller list",
          "Support filtering options"
        ]
      }
    },
    "task-1-4-2": {
      "type": "subtask",
      "title": "Implement get_callees() function",
      "status": "pending",
      "parent": "task-1-4",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-1-4-3"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Query calls from function data",
          "Return formatted callee list",
          "Support filtering options"
        ]
      }
    },
    "task-1-4-3": {
      "type": "subtask",
      "title": "Implement build_call_graph() function",
      "status": "pending",
      "parent": "task-1-4",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-1-4-1",
          "task-1-4-2"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Recursively build call graph",
          "Support max depth parameter",
          "Return graph structure for visualization"
        ]
      }
    },
    "task-1-5": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/doc_query/cli.py",
      "status": "pending",
      "parent": "phase-1-files",
      "children": [
        "task-1-5-1",
        "task-1-5-2",
        "task-1-5-3"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-1-4"
        ],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/doc_query/cli.py",
        "description": "Add CLI commands for cross-references",
        "estimated_hours": 4
      }
    },
    "task-1-5-1": {
      "type": "subtask",
      "title": "Add 'sdd doc callers' command",
      "status": "pending",
      "parent": "task-1-5",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Create callers CLI command",
          "Add --format text|json option",
          "Add --docs-path parameter"
        ]
      }
    },
    "task-1-5-2": {
      "type": "subtask",
      "title": "Add 'sdd doc callees' command",
      "status": "pending",
      "parent": "task-1-5",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Create callees CLI command",
          "Add --format text|json option",
          "Add --docs-path parameter"
        ]
      }
    },
    "task-1-5-3": {
      "type": "subtask",
      "title": "Add 'sdd doc call-graph' command",
      "status": "pending",
      "parent": "task-1-5",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Create call-graph CLI command",
          "Add --max-depth parameter",
          "Add --format dot|json option"
        ]
      }
    },
    "phase-1-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-1",
      "children": [
        "verify-1-1",
        "verify-1-2",
        "verify-1-3",
        "verify-1-4",
        "verify-1-5"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-1-files"
        ],
        "depends": []
      },
      "total_tasks": 5,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-1-1": {
      "type": "verify",
      "title": "Reverse dependencies work correctly",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "command": "sdd doc dependencies [module] --reverse",
        "expected": "Returns all modules that import the target module"
      }
    },
    "verify-1-2": {
      "type": "verify",
      "title": "Cross-reference data present in documentation.json",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "expected": "Functions have callers and calls arrays, classes have instantiated_by and imported_by",
        "command": ""
      }
    },
    "verify-1-3": {
      "type": "verify",
      "title": "New CLI commands work",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "sdd doc callers [function] && sdd doc callees [function] && sdd doc call-graph [function]",
        "expected": "All three commands return valid output"
      }
    },
    "verify-1-4": {
      "type": "verify",
      "title": "Schema v2.0 compatibility",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "expected": "Documentation generation produces v2.0 schema with all cross-reference fields",
        "command": ""
      }
    },
    "verify-1-5": {
      "type": "verify",
      "title": "Cross-reference accuracy on dynamic Python codebase",
      "status": "pending",
      "parent": "phase-1-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "command": "Test code-doc skill on codebase with decorators, monkey-patching, and dynamic calls",
        "expected": "Warnings logged for dynamic patterns; known limitations documented in output; static call detection coverage > 80%",
        "rationale": "Addresses review feedback on dynamic Python analysis risk - ensures mitigation strategy works as intended"
      }
    },
    "phase-2": {
      "type": "phase",
      "title": "P1: Core Wrapper Commands",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-2-files",
        "phase-2-verify"
      ],
      "dependencies": {
        "blocks": [
          "phase-3"
        ],
        "blocked_by": [
          "phase-1"
        ],
        "depends": []
      },
      "total_tasks": 18,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Implement 4 high-impact wrapper commands that automate common workflows",
        "risk_level": "medium",
        "estimated_hours": 110,
        "dependencies": "Requires Phase 1 cross-reference data",
        "revision_note": "Increased from 80h based on review feedback - complex graph traversal and data-flow analysis require more buffer"
      }
    },
    "phase-2-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-2",
      "children": [
        "task-2-1",
        "task-2-2",
        "task-2-3",
        "task-2-4",
        "task-2-5"
      ],
      "total_tasks": 13,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-2-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-2-1": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/doc_query/workflows/trace_entry.py (new file)",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [
        "task-2-1-1",
        "task-2-1-2",
        "task-2-1-3"
      ],
      "dependencies": {
        "blocks": [
          "task-2-5"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/doc_query/workflows/trace_entry.py",
        "description": "Implement trace-entry workflow command",
        "estimated_hours": 12,
        "is_new_file": true
      }
    },
    "task-2-1-1": {
      "type": "subtask",
      "title": "Implement call chain traversal logic",
      "status": "pending",
      "parent": "task-2-1",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-2-1-2"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Find entry function",
          "Build call chain with max depth",
          "Track visited nodes",
          "Identify architectural layers"
        ]
      }
    },
    "task-2-1-2": {
      "type": "subtask",
      "title": "Implement output formatting",
      "status": "pending",
      "parent": "task-2-1",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-2-1-3"
        ],
        "blocked_by": [
          "task-2-1-1"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Tree visualization with layers",
          "Complexity highlighting",
          "Hot spots identification",
          "Dependencies summary"
        ]
      }
    },
    "task-2-1-3": {
      "type": "subtask",
      "title": "Add CLI integration",
      "status": "pending",
      "parent": "task-2-1",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-2-1-2"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Add sdd doc trace-entry command",
          "Support --max-depth, --format options"
        ]
      }
    },
    "task-2-2": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/doc_query/workflows/trace_data.py (new file)",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [
        "task-2-2-1",
        "task-2-2-2",
        "task-2-2-3"
      ],
      "dependencies": {
        "blocks": [
          "task-2-5"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/doc_query/workflows/trace_data.py",
        "description": "Implement trace-data workflow command",
        "estimated_hours": 12,
        "is_new_file": true
      }
    },
    "task-2-2-1": {
      "type": "subtask",
      "title": "Implement lifecycle operation detection",
      "status": "pending",
      "parent": "task-2-2",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-2-2-2"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Find class definition",
          "Detect creation patterns",
          "Detect read/update/delete operations",
          "Build data flow graph"
        ]
      }
    },
    "task-2-2-2": {
      "type": "subtask",
      "title": "Implement output formatting",
      "status": "pending",
      "parent": "task-2-2",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-2-2-3"
        ],
        "blocked_by": [
          "task-2-2-1"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Lifecycle visualization",
          "Usage map by layer",
          "Property access analysis",
          "Mutation hot spots"
        ]
      }
    },
    "task-2-2-3": {
      "type": "subtask",
      "title": "Add CLI integration",
      "status": "pending",
      "parent": "task-2-2",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-2-2-2"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Add sdd doc trace-data command",
          "Support --include-properties, --format options"
        ]
      }
    },
    "task-2-3": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/doc_query/workflows/impact_analysis.py (new file)",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [
        "task-2-3-1",
        "task-2-3-2",
        "task-2-3-3"
      ],
      "dependencies": {
        "blocks": [
          "task-2-5"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/doc_query/workflows/impact_analysis.py",
        "description": "Implement impact analysis workflow command",
        "estimated_hours": 16,
        "is_new_file": true
      }
    },
    "task-2-3-1": {
      "type": "subtask",
      "title": "Implement blast radius calculation",
      "status": "pending",
      "parent": "task-2-3",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-2-3-2"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Get direct dependents using cross-refs",
          "Calculate indirect dependents (2nd degree)",
          "Find tests covering entity",
          "Calculate risk score"
        ]
      }
    },
    "task-2-3-2": {
      "type": "subtask",
      "title": "Implement output formatting with recommendations",
      "status": "pending",
      "parent": "task-2-3",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-2-3-3"
        ],
        "blocked_by": [
          "task-2-3-1"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Blast radius visualization",
          "Risk matrix display",
          "Test coverage report",
          "Actionable recommendations",
          "Change checklist generation"
        ]
      }
    },
    "task-2-3-3": {
      "type": "subtask",
      "title": "Add CLI integration",
      "status": "pending",
      "parent": "task-2-3",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-2-3-2"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Add sdd doc impact command",
          "Support --type, --max-depth, --include-tests, --format options"
        ]
      }
    },
    "task-2-4": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/doc_query/workflows/refactor_candidates.py (new file)",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [
        "task-2-4-1",
        "task-2-4-2",
        "task-2-4-3"
      ],
      "dependencies": {
        "blocks": [
          "task-2-5"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/doc_query/workflows/refactor_candidates.py",
        "description": "Implement refactor-candidates workflow command",
        "estimated_hours": 12,
        "is_new_file": true
      }
    },
    "task-2-4-1": {
      "type": "subtask",
      "title": "Implement priority scoring algorithm",
      "status": "pending",
      "parent": "task-2-4",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-2-4-2"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Find high-complexity functions",
          "Get dependent count for each",
          "Calculate priority score (complexity \u00d7 dependents)",
          "Categorize risk level"
        ]
      }
    },
    "task-2-4-2": {
      "type": "subtask",
      "title": "Implement output formatting",
      "status": "pending",
      "parent": "task-2-4",
      "children": [],
      "dependencies": {
        "blocks": [
          "task-2-4-3"
        ],
        "blocked_by": [
          "task-2-4-1"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Ranked table by priority score",
          "Priority matrix distribution",
          "Recommended action plan",
          "Export options (json, csv)"
        ]
      }
    },
    "task-2-4-3": {
      "type": "subtask",
      "title": "Add CLI integration",
      "status": "pending",
      "parent": "task-2-4",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-2-4-2"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Add sdd doc refactor-candidates command",
          "Support --threshold, --min-dependents, --format options"
        ]
      }
    },
    "task-2-5": {
      "type": "task",
      "title": "skills/doc-query/SKILL.md",
      "status": "pending",
      "parent": "phase-2-files",
      "children": [
        "task-2-5-1"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-2-1",
          "task-2-2",
          "task-2-3",
          "task-2-4"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "skills/doc-query/SKILL.md",
        "description": "Update documentation with new wrapper commands",
        "estimated_hours": 4
      }
    },
    "task-2-5-1": {
      "type": "subtask",
      "title": "Add documentation for wrapper commands",
      "status": "pending",
      "parent": "task-2-5",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Add examples for trace-entry",
          "Add examples for trace-data",
          "Add examples for impact",
          "Add examples for refactor-candidates",
          "Update workflow sections to reference new commands"
        ]
      }
    },
    "phase-2-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-2",
      "children": [
        "verify-2-1",
        "verify-2-2",
        "verify-2-3",
        "verify-2-4",
        "verify-2-5"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-2-files"
        ],
        "depends": []
      },
      "total_tasks": 5,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-2-1": {
      "type": "verify",
      "title": "trace-entry reduces workflow from 6 commands to 1",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "command": "sdd doc trace-entry [function]",
        "expected": "Complete execution flow with layers, complexity, dependencies in single output"
      }
    },
    "verify-2-2": {
      "type": "verify",
      "title": "trace-data shows complete lifecycle",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "command": "sdd doc trace-data [class]",
        "expected": "Creation, reading, updating, deletion operations all identified with usage map"
      }
    },
    "verify-2-3": {
      "type": "verify",
      "title": "impact analysis uses cross-refs not search",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "command": "sdd doc impact [function]",
        "expected": "Accurate dependent count using callers, not search fallback. Risk assessment included."
      }
    },
    "verify-2-4": {
      "type": "verify",
      "title": "refactor-candidates automates prioritization",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "command": "sdd doc refactor-candidates --threshold 10",
        "expected": "Ranked list with priority scores, risk levels, and action plan"
      }
    },
    "verify-2-5": {
      "type": "verify",
      "title": "Output sanitization prevents injection attacks",
      "status": "pending",
      "parent": "phase-2-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "manual",
        "command": "Test with crafted function names containing special characters: '; DROP TABLE;', '<script>alert(1)</script>', '../../../etc/passwd', '${evil}'",
        "expected": "All outputs (dot files, JSON, text) properly escape/sanitize special characters; no command injection possible",
        "rationale": "Addresses security consideration from review - ensures generated outputs cannot be exploited via crafted identifiers"
      }
    },
    "phase-3": {
      "type": "phase",
      "title": "P2: Refinements - Native Filtering",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-3-files",
        "phase-3-verify"
      ],
      "dependencies": {
        "blocks": [
          "phase-4"
        ],
        "blocked_by": [
          "phase-2"
        ],
        "depends": []
      },
      "total_tasks": 6,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Add native pattern filtering to eliminate grep dependencies",
        "risk_level": "low",
        "estimated_hours": 24,
        "dependencies": "Independent of previous phases but builds on them"
      }
    },
    "phase-3-files": {
      "type": "group",
      "title": "File Modifications",
      "status": "pending",
      "parent": "phase-3",
      "children": [
        "task-3-1",
        "task-3-2"
      ],
      "total_tasks": 4,
      "completed_tasks": 0,
      "metadata": {},
      "dependencies": {
        "blocks": [
          "phase-3-verify"
        ],
        "blocked_by": [],
        "depends": []
      }
    },
    "task-3-1": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/doc_query/doc_query_lib.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [
        "task-3-1-1"
      ],
      "dependencies": {
        "blocks": [
          "task-3-2"
        ],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/doc_query/doc_query_lib.py",
        "description": "Add pattern filtering helper function",
        "estimated_hours": 4
      }
    },
    "task-3-1-1": {
      "type": "subtask",
      "title": "Add apply_pattern_filter() helper function",
      "status": "pending",
      "parent": "task-3-1",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Create regex pattern matcher",
          "Support both string and compiled regex",
          "Return filtered results",
          "Handle edge cases (invalid regex, etc)"
        ]
      }
    },
    "task-3-2": {
      "type": "task",
      "title": "src/claude_skills/claude_skills/doc_query/cli.py",
      "status": "pending",
      "parent": "phase-3-files",
      "children": [
        "task-3-2-1",
        "task-3-2-2",
        "task-3-2-3"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "task-3-1"
        ],
        "depends": []
      },
      "total_tasks": 3,
      "completed_tasks": 0,
      "metadata": {
        "file_path": "src/claude_skills/claude_skills/doc_query/cli.py",
        "description": "Add --pattern flag to list commands",
        "estimated_hours": 8
      }
    },
    "task-3-2-1": {
      "type": "subtask",
      "title": "Add --pattern to list-modules command",
      "status": "pending",
      "parent": "task-3-2",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Add --pattern option to CLI",
          "Apply filtering before output",
          "Preserve JSON output compatibility"
        ]
      }
    },
    "task-3-2-2": {
      "type": "subtask",
      "title": "Add --pattern to list-classes and list-functions commands",
      "status": "pending",
      "parent": "task-3-2",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Add --pattern option to both commands",
          "Apply filtering logic",
          "Maintain consistent interface"
        ]
      }
    },
    "task-3-2-3": {
      "type": "subtask",
      "title": "Add --module-pattern to complexity command",
      "status": "pending",
      "parent": "task-3-2",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "changes": [
          "Add --module-pattern option",
          "Filter by module path before complexity analysis",
          "Preserve --json flag functionality"
        ]
      }
    },
    "phase-3-verify": {
      "type": "group",
      "title": "Verification",
      "status": "pending",
      "parent": "phase-3",
      "children": [
        "verify-3-1",
        "verify-3-2"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-3-files"
        ],
        "depends": []
      },
      "total_tasks": 2,
      "completed_tasks": 0,
      "metadata": {}
    },
    "verify-3-1": {
      "type": "verify",
      "title": "Pattern filtering works on all list commands",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "sdd doc list-modules --pattern '(main|index)' && sdd doc list-classes --pattern '.*Service' && sdd doc complexity --module-pattern '*auth*'",
        "expected": "All commands filter correctly without requiring grep"
      }
    },
    "verify-3-2": {
      "type": "verify",
      "title": "JSON output preserved with filtering",
      "status": "pending",
      "parent": "phase-3-verify",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "verification_type": "auto",
        "command": "sdd doc list-modules --pattern 'doc' --json | jq .",
        "expected": "Valid JSON output that can be piped to jq"
      }
    },
    "phase-4": {
      "type": "phase",
      "title": "P3: Advanced Features (Future)",
      "status": "pending",
      "parent": "spec-root",
      "children": [
        "phase-4-files"
      ],
      "dependencies": {
        "blocks": [],
        "blocked_by": [
          "phase-3"
        ],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "purpose": "Framework detection, interactive mode, and architecture detection - deferred based on user feedback",
        "risk_level": "medium",
        "estimated_hours": 56,
        "dependencies": "Builds on all previous phases",
        "note": "Placeholder phase - implementation deferred to future based on P0-P2 feedback"
      }
    },
    "phase-4-files": {
      "type": "group",
      "title": "Placeholder Tasks",
      "status": "pending",
      "parent": "phase-4",
      "children": [
        "task-4-1"
      ],
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {}
    },
    "task-4-1": {
      "type": "task",
      "title": "Future: Architecture detection, interactive mode, framework-aware queries",
      "status": "pending",
      "parent": "phase-4-files",
      "children": [],
      "dependencies": {
        "blocks": [],
        "blocked_by": [],
        "depends": []
      },
      "total_tasks": 1,
      "completed_tasks": 0,
      "metadata": {
        "description": "Placeholder for P3 features - to be planned based on feedback from P0-P2 implementation",
        "estimated_hours": 56,
        "deferred": true,
        "file_path": "tbd"
      }
    }
  },
  "journal": [
    {
      "timestamp": "2025-10-26T12:59:08.437990+00:00",
      "entry_type": "note",
      "title": "Progress Update: Cross-Reference Tracking Foundation Complete",
      "author": "claude-code",
      "content": "Completed foundational work for task-1-2 (approximately 25% of 16-hour estimate):\n\n**Files Created:**\n- ast_analysis.py: Core data structures for cross-reference tracking\n  - CrossReferenceGraph class with bidirectional indexing\n  - CallSite and InstantiationSite tracking\n  - DynamicPatternWarning system for accuracy limitations\n  - Full serialization support for JSON output\n\n**Files Modified:**\n- base.py: Updated ParseResult to include cross_references field\n  - Added merge() logic for combining graphs from multiple files\n  - Integrated cross-references into to_dict() for JSON output\n\n**Design Decisions:**\n1. Bidirectional Indexing: Separate forward/reverse lookup dictionaries for O(1) query performance\n2. Modular Design: CrossReferenceGraph is independent class, can be used standalone\n3. Extensible Metadata: Each reference has metadata dict for future enhancements\n4. Warning System: Explicit tracking of dynamic patterns (decorators, reflection, etc.) that affect accuracy\n\n**Remaining Work (est. 12 hours):**\n- Python parser integration (3-4 hours)\n- Class instantiation tracking (3-4 hours)  \n- Dynamic pattern detection (3-4 hours)\n- Testing and documentation (2-3 hours)\n\n**Status:** Foundation complete, ready for parser integration.",
      "metadata": {},
      "task_id": "task-1-2"
    },
    {
      "timestamp": "2025-10-26T13:08:53.954143+00:00",
      "entry_type": "note",
      "title": "Task-1-2-1: Function Call Tracking Implementation",
      "author": "claude-code",
      "content": "Implemented function call tracking during AST traversal in Python parser.\n\n## Implementation Details\n\n**CallTracker Class (_CallTracker)**:\n- Nested class in PythonParser inheriting from ast.NodeVisitor\n- Maintains context stack to track current function/class being analyzed\n- Overrides visit_FunctionDef, visit_AsyncFunctionDef, visit_ClassDef for context tracking\n- Overrides visit_Call to capture function and method calls\n\n**Context Tracking**:\n- Uses context_stack to handle nested functions and classes\n- Identifies caller as current_function or '<module>' for module-level calls\n- Records class context in metadata for method calls\n\n**Call Detection**:\n- Distinguishes between function calls (ast.Name) and method calls (ast.Attribute)\n- Extracts callee name from simple calls, method calls, and chained calls\n- Creates CallSite objects with caller, callee, line numbers, and metadata\n- Adds to CrossReferenceGraph for bidirectional indexing\n\n**Integration**:\n- Creates CrossReferenceGraph in parse_file() before parsing\n- Calls tracker.visit(tree) after AST parse to walk entire tree\n- Assigns graph to result.cross_references\n\n## Verification\n\n**Test Results**:\n- 11 new tests added (TestPythonParserCrossReferences class)\n- All 27 total tests pass (16 existing + 11 new)\n- Tests cover: simple calls, nested calls, method calls, class methods, module-level calls, bidirectional lookups, multiple callers, decorators, empty files, line numbers\n\n**Manual Testing**:\n- Tested on python.py itself: tracked 82 calls across 38 callees and 12 callers\n- Sample calls verified: _push_context->append, _pop_context->pop, etc.\n\n## Key Design Decisions\n\n1. **Context Stack**: Maintains full context path for nested functions\n2. **Module-level Calls**: Tracked with caller='<module>' for top-level code\n3. **Method Call Type**: Uses ast.Attribute to distinguish methods from functions\n4. **Metadata**: Stores class context and full context path for future analysis\n5. **Graceful Degradation**: Returns None for complex call expressions (lambdas, subscripts)\n\n## Edge Cases Handled\n\n- Nested functions and classes\n- Decorator functions (don't confuse decorator with call)\n- Module-level calls\n- Empty files (creates empty graph)\n- Method calls vs function calls\n- Chained calls (extracts final method name)\n\n## Performance\n\n- O(n) traversal of AST tree where n = number of nodes\n- O(1) bidirectional lookups via callers/callees dictionaries\n- Minimal memory overhead per call site (~200 bytes)\n\n## Next Steps\n\n- task-1-2-2: Implement class instantiation tracking\n- task-1-2-3: Build bidirectional reference graph (may already be complete)\n- task-1-2-4: Add warning system for dynamic Python patterns\n\n## Files Modified\n\n- src/claude_skills/claude_skills/code_doc/parsers/python.py\n- src/claude_skills/claude_skills/tests/unit/test_code_doc/test_parsers_python.py",
      "metadata": {}
    },
    {
      "timestamp": "2025-10-26T13:11:33.632112+00:00",
      "entry_type": "note",
      "title": "Task-1-1: Reverse Dependency Support Verified",
      "author": "claude-code",
      "content": "Verified that reverse dependency support is already fully implemented and working in the doc-query skill.\n\n## Investigation Results\n\n**Schema Inspection (task-1-1-1)**:\n- Confirmed imported_by field exists in module schema\n- Reverse dependency tracking structure validated in documentation.json\n- Data structure supports bidirectional dependency lookups\n\n**Functional Testing (task-1-1-2)**:\n- Tested 'sdd doc dependencies --reverse' on real codebase\n- Command works correctly with import names (e.g., 'claude_skills.sdd_next.next_task')\n- Identified limitation: requires import names, not file paths\n- This is by design - consistent with forward dependency behavior\n\n**Documentation (task-1-1-3)**:\n- Created comprehensive findings report\n- Enhanced SKILL.md documentation clarifying import name vs file path usage\n- Added usage examples for reverse dependency queries\n- Documented query patterns and best practices\n\n## Conclusion\n\nNo implementation fix needed - feature is working as designed. The perceived gap was actually a documentation gap, which has been resolved.\n\n## Impact\n\n- Unblocked task-1-2 (cross-reference tracking implementation)\n- Confirmed foundation for Phase 1 is solid\n- Documentation improvements benefit all doc-query users",
      "metadata": {},
      "task_id": "task-1-1"
    }
  ]
}